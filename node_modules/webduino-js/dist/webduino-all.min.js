!function(n,o){"use strict";var i,r,a,s,c,h,t,e;function u(e){delete r[e]}function l(e){if(a)setTimeout(l,0,e);else{var t=r[e];if(t){a=!0;try{var n=t,i=n.callback,s=n.args;switch(s.length){case 0:i();break;case 1:i(s[0]);break;case 2:i(s[0],s[1]);break;case 3:i(s[0],s[1],s[2]);break;default:i.apply(o,s)}}finally{u(e),a=!1}}}}function d(){function e(e){e.source===n&&"string"==typeof e.data&&0===e.data.indexOf(t)&&l(+e.data.slice(t.length))}var t="setImmediate$"+Math.random()+"$";n.addEventListener?n.addEventListener("message",e,!1):n.attachEvent("onmessage",e),c=function(e){n.postMessage(t+e,"*")}}n.setImmediate||(i=1,a=!(r={}),s=n.document,e=(e=Object.getPrototypeOf&&Object.getPrototypeOf(n))&&e.setTimeout?e:n,"[object process]"==={}.toString.call(n.process)?c=function(e){process.nextTick(function(){l(e)})}:!function(){var e,t;if(n.postMessage&&!n.importScripts)return e=!0,t=n.onmessage,n.onmessage=function(){e=!1},n.postMessage("","*"),n.onmessage=t,e}()?c=n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){l(e.data)},function(e){t.port2.postMessage(e)}):s&&"onreadystatechange"in s.createElement("script")?(h=s.documentElement,function(e){var t=s.createElement("script");t.onreadystatechange=function(){l(e),t.onreadystatechange=null,h.removeChild(t),t=null},h.appendChild(t)}):function(e){setTimeout(l,0,e)}:d(),e.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];return r[i]={callback:e,args:t},c(i),i++},e.clearImmediate=u)}("undefined"==typeof self?"undefined"==typeof global?this:global:self),(Paho="undefined"==typeof Paho?{}:Paho).MQTT=function(r){function u(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){var i="Unknown property, "+n+". Valid properties are:";for(n in t)t.hasOwnProperty(n)&&(i=i+" "+n);throw new Error(i)}if(typeof e[n]!==t[n])throw new Error(M(R.INVALID_TYPE,[typeof e[n],n]))}}function n(e,t){return function(){return e.apply(t,arguments)}}function f(e,t){for(var n in this.type=e,t)t.hasOwnProperty(n)&&(this[n]=t[n])}var l=1,p=2,g=3,m=4,v=5,b=6,E=7,d=8,y=9,_=10,S=11,a=12,A=13,e=14,R={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: ${0}."}},w={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},M=function(e,t){var n=e.text;if(t)for(var i,s,o,r=0;r<t.length;r++)0<(o=n.indexOf(s="{"+r+"}"))&&(i=n.substring(0,o),o=n.substring(o+s.length),n=i+t[r]+o);return n},I=[0,6,77,81,73,115,100,112,3],O=[0,4,77,81,84,84,4];function N(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function T(e,t,n,i){return c(e,n,i=N(t,n,i)),i+t}function C(e,t){return 256*e[t]+e[t+1]}function P(e){for(var t=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);2047<i?(55296<=i&&i<=56319&&(n++,t++),t+=3):127<i?t+=2:t++}return t}function c(e,t,n){for(var i=n,s=0;s<e.length;s++){var o=e.charCodeAt(s);if(55296<=o&&o<=56319){var r=e.charCodeAt(++s);if(isNaN(r))throw new Error(M(R.MALFORMED_UNICODE,[o,r]));o=r-56320+(o-55296<<10)+65536}o<=127?t[i++]=o:(o<=2047?t[i++]=o>>6&31|192:(o<=65535?t[i++]=o>>12&15|224:(t[i++]=o>>18&7|240,t[i++]=o>>12&63|128),t[i++]=o>>6&63|128),t[i++]=63&o|128)}}function D(e,t,n){for(var i,s="",o=t;o<t+n;){var r=e[o++];if(r<128)i=r;else{var a=e[o++]-128;if(a<0)throw new Error(M(R.MALFORMED_UTF,[r.toString(16),a.toString(16),""]));if(r<224)i=64*(r-192)+a;else{var c=e[o++]-128;if(c<0)throw new Error(M(R.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16)]));if(r<240)i=4096*(r-224)+64*a+c;else{var h=e[o++]-128;if(h<0)throw new Error(M(R.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16),h.toString(16)]));if(!(r<248))throw new Error(M(R.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16),h.toString(16)]));i=262144*(r-240)+4096*a+64*c+h}}}65535<i&&(i-=65536,s+=String.fromCharCode(55296+(i>>10)),i=56320+(1023&i)),s+=String.fromCharCode(i)}return s}function i(e,t,n){this._client=e,this._window=t,this._keepAliveInterval=1e3*n,this.isReset=!1;var i=new f(a).encode(),s=function(e){return function(){return o.apply(e)}},o=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(i),this.timeout=this._window.setTimeout(s(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(R.PING_TIMEOUT.code,M(R.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),0<this._keepAliveInterval&&(this.timeout=setTimeout(s(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}}function s(e,t,n){this._client=e,this._window=t,this._reconnectInterval=1e3*n;var i=function(e){return function(){return function(){if(this._client.connected){this._client._trace("Reconnector.doReconnect","ALREADY CONNECTED");this._window.clearTimeout(this.reconnectorTimer)}else{this._client._trace("Reconnector.doReconnect","reconnecting");if(this._client.connectOptions.uris){this._client.hostIndex=0;this._client._doConnect(this._client.connectOptions.uris[0])}else this._client._doConnect(this._client.uri);this.reconnectorTimer=this._window.setTimeout(i(this),this._reconnectInterval)}}.apply(e)}};this.reset=function(){this._window.clearTimeout(this.reconnectorTimer),this.reconnectorTimer=this._window.setTimeout(i(this),this._reconnectInterval)},this.cancel=function(){this._window.clearTimeout(this.reconnectorTimer)}}function o(e,t,n,i,s){var o,r,a;this._window=t,n=n||30,this.timeout=setTimeout((o=i,r=e,a=s,function(){return o.apply(r,a)}),1e3*n),this.cancel=function(){this._window.clearTimeout(this.timeout)}}function L(e,t,n,i,s){if(!("WebSocket"in r&&null!==r.WebSocket))throw new Error(M(R.UNSUPPORTED,["WebSocket"]));if("localStorage"in r&&null!==r.localStorage||(localStorage={store:{},setItem:function(e,t){this.store[e]=t},getItem:function(e){return this.store[e]},removeItem:function(e){delete this.store[e]}}),!("ArrayBuffer"in r&&null!==r.ArrayBuffer))throw new Error(M(R.UNSUPPORTED,["ArrayBuffer"]));for(var o in this._trace("Paho.MQTT.Client",e,t,n,i,s),this.host=t,this.port=n,this.path=i,this.uri=e,this.clientId=s,this._wsuri=null,this._localKey=t+":"+n+("/mqtt"!=i?":"+i:"")+":"+s+":",this._msg_queue=[],this._buffered_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,localStorage)0!=o.indexOf("Sent:"+this._localKey)&&0!=o.indexOf("Received:"+this._localKey)||this.restore(o)}function t(e,t,r,n){if("string"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"host"]));if(2==arguments.length){n=t;var a,i=(a=e).match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!i)throw new Error(M(R.INVALID_ARGUMENT,[e,"host"]));e=i[4]||i[2],t=parseInt(i[7]),r=i[8]}else{if(3==arguments.length&&(n=r,r="/mqtt"),"number"!=typeof t||t<0)throw new Error(M(R.INVALID_TYPE,[typeof t,"port"]));if("string"!=typeof r)throw new Error(M(R.INVALID_TYPE,[typeof r,"path"]));i=-1!=e.indexOf(":")&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);a="ws://"+(i?"["+e+"]":e)+":"+t+r}for(var s=0,o=0;o<n.length;o++){var c=n.charCodeAt(o);55296<=c&&c<=56319&&o++,s++}if("string"!=typeof n||65535<s)throw new Error(M(R.INVALID_ARGUMENT,[n,"clientId"]));var h=new L(a,e,t,r,n);this._getHost=function(){return e},this._setHost=function(){throw new Error(M(R.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(M(R.UNSUPPORTED_OPERATION))},this._getPath=function(){return r},this._setPath=function(){throw new Error(M(R.UNSUPPORTED_OPERATION))},this._getURI=function(){return a},this._setURI=function(){throw new Error(M(R.UNSUPPORTED_OPERATION))},this._getClientId=function(){return h.clientId},this._setClientId=function(){throw new Error(M(R.UNSUPPORTED_OPERATION))},this._getOnConnected=function(){return h.onConnected},this._setOnConnected=function(e){if("function"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"onConnected"]));h.onConnected=e},this._getDisconnectedPublishing=function(){return h.disconnectedPublishing},this._setDisconnectedPublishing=function(e){h.disconnectedPublishing=e},this._getDisconnectedBufferSize=function(){return h.disconnectedBufferSize},this._setDisconnectedBufferSize=function(e){h.disconnectedBufferSize=e},this._getOnConnectionLost=function(){return h.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"onConnectionLost"]));h.onConnectionLost=e},this._getOnMessageDelivered=function(){return h.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"onMessageDelivered"]));h.onMessageDelivered=e},this._getOnMessageArrived=function(){return h.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"onMessageArrived"]));h.onMessageArrived=e},this._getTrace=function(){return h.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(M(R.INVALID_TYPE,[typeof e,"onTrace"]));h.traceFunction=e},this.connect=function(e){if(u(e=e||{},{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",reconnectInterval:"number",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),4<e.mqttVersion||e.mqttVersion<3)throw new Error(M(R.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0!==e.password&&void 0===e.userName)throw new Error(M(R.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(void 0===e.reconnectInterval&&(e.reconnectInterval=10),e.willMessage){if(!(e.willMessage instanceof k))throw new Error(M(R.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,void 0===e.willMessage.destinationName)throw new Error(M(R.INVALID_TYPE,[typeof e.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if(void 0===e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(M(R.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(M(R.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,n=0;n<e.hosts.length;n++){if("string"!=typeof e.hosts[n])throw new Error(M(R.INVALID_TYPE,[typeof e.hosts[n],"connectOptions.hosts["+n+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[n])){if(0==n)t=!0;else if(!t)throw new Error(M(R.INVALID_ARGUMENT,[e.hosts[n],"connectOptions.hosts["+n+"]"]))}else if(t)throw new Error(M(R.INVALID_ARGUMENT,[e.hosts[n],"connectOptions.hosts["+n+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(M(R.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(M(R.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(M(R.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(n=0;n<e.hosts.length;n++){if("number"!=typeof e.ports[n]||e.ports[n]<0)throw new Error(M(R.INVALID_TYPE,[typeof e.ports[n],"connectOptions.ports["+n+"]"]));var i=e.hosts[n],s=e.ports[n],o=-1!=i.indexOf(":");a="ws://"+(o?"["+i+"]":i)+":"+s+r,e.uris.push(a)}}}h.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(u(t=t||{},{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(M(R.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));h.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(u(t=t||{},{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");h.unsubscribe(e,t)},this.send=function(e,t,n,i){var s;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof k)&&"string"!=typeof e)throw new Error("Invalid argument:"+typeof e);if(void 0===(s=e).destinationName)throw new Error(M(R.INVALID_ARGUMENT,[s.destinationName,"Message.destinationName"]))}else(s=new k(t)).destinationName=e,3<=arguments.length&&(s.qos=n),4<=arguments.length&&(s.retained=i);h.send(s)},this.disconnect=function(){h.disconnect()},this.getTraceLog=function(){return h.getTraceLog()},this.startTrace=function(){h.startTrace()},this.stopTrace=function(){h.stopTrace()},this.isConnected=function(){return h.connected}}L.prototype.connected=!(f.prototype.encode=function(){var e,t=(15&this.type)<<4,n=0,i=new Array,s=0;switch(null!=this.messageIdentifier&&(n+=2),this.type){case l:switch(this.mqttVersion){case 3:n+=I.length+3;break;case 4:n+=O.length+3}n+=P(this.clientId)+2,null!=this.willMessage&&(n=(n+=P(this.willMessage.destinationName)+2)+((e=(e=this.willMessage.payloadBytes)instanceof Uint8Array?e:new Uint8Array(r)).byteLength+2)),null!=this.userName&&(n+=P(this.userName)+2),null!=this.password&&(n+=P(this.password)+2);break;case d:t|=2;for(var o=0;o<this.topics.length;o++)i[o]=P(this.topics[o]),n+=i[o]+2;n+=this.requestedQos.length;break;case _:t|=2;for(o=0;o<this.topics.length;o++)i[o]=P(this.topics[o]),n+=i[o]+2;break;case b:t|=2;break;case g:this.payloadMessage.duplicate&&(t|=8),t|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(t|=1);var s=P(this.payloadMessage.destinationName),r=this.payloadMessage.payloadBytes,n=n+(s+2)+r.byteLength;r instanceof ArrayBuffer?r=new Uint8Array(r):r instanceof Uint8Array||(r=new Uint8Array(r.buffer))}var a=function(e){var t=new Array(1),n=0;do{var i=e%128}while(0<(e>>=7)&&(i|=128),t[n++]=i,0<e&&n<4);return t}(n),c=a.length+1,h=new ArrayBuffer(n+c),u=new Uint8Array(h);if(u[0]=t,u.set(a,1),this.type==g)c=T(this.payloadMessage.destinationName,s,u,c);else if(this.type==l){switch(this.mqttVersion){case 3:u.set(I,c),c+=I.length;break;case 4:u.set(O,c),c+=O.length}a=0;this.cleanSession&&(a=2),null!=this.willMessage&&(a=4|a|this.willMessage.qos<<3,this.willMessage.retained&&(a|=32)),null!=this.userName&&(a|=128),null!=this.password&&(a|=64),u[c++]=a,c=N(this.keepAliveInterval,u,c)}switch(null!=this.messageIdentifier&&(c=N(this.messageIdentifier,u,c)),this.type){case l:c=T(this.clientId,P(this.clientId),u,c),null!=this.willMessage&&(c=T(this.willMessage.destinationName,P(this.willMessage.destinationName),u,c),c=N(e.byteLength,u,c),u.set(e,c),c+=e.byteLength),null!=this.userName&&(c=T(this.userName,P(this.userName),u,c)),null!=this.password&&(c=T(this.password,P(this.password),u,c));break;case g:u.set(r,c);break;case d:for(o=0;o<this.topics.length;o++)c=T(this.topics[o],i[o],u,c),u[c++]=this.requestedQos[o];break;case _:for(o=0;o<this.topics.length;o++)c=T(this.topics[o],i[o],u,c)}return h}),L.prototype.maxMessageIdentifier=65536,L.prototype._msg_queue=null,L.prototype._buffered_queue=null,L.prototype.sendPinger=null,L.prototype.receivePinger=null,L.prototype.reconnector=null,L.prototype.disconnectedPublishing=!1,L.prototype.disconnectedBufferSize=5e3,L.prototype.receiveBuffer=null,L.prototype._traceBuffer=null,L.prototype._MAX_TRACE_ENTRIES=100,L.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(M(R.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(M(R.INVALID_STATE,["already connected"]));(this.connectOptions=e).uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},L.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(M(R.INVALID_STATE,["not connected"]));var n=new f(d);n.topics=[e],null!=t.qos?n.requestedQos=[t.qos]:n.requestedQos=[0],t.onSuccess&&(n.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(n.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(n.timeOut=new o(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:R.SUBSCRIBE_TIMEOUT.code,errorMessage:M(R.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},L.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(M(R.INVALID_STATE,["not connected"]));var n=new f(_);n.topics=[e],t.onSuccess&&(n.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(n.timeOut=new o(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:R.UNSUBSCRIBE_TIMEOUT.code,errorMessage:M(R.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},L.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected){if(this.reconnector&&this.disconnectedPublishing){if(this._buffered_queue.length===this.disconnectedBufferSize)throw new Error(M(R.BUFFER_FULL,[this._buffered_queue.length]));return void this._buffered_queue.push(e)}throw new Error(M(R.INVALID_STATE,["not connected"]))}0<((wireMessage=new f(g)).payloadMessage=e).qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},L.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(M(R.INVALID_STATE,["not connecting or connected"]));wireMessage=new f(e),this._notify_msg_sent[wireMessage]=n(this._disconnected,this),this._schedule_message(wireMessage)},L.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var e in this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length),this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},L.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@")},L.prototype.stopTrace=function(){delete this._traceBuffer},L.prototype._doConnect=function(e){var t;this.connectOptions.useSSL&&((t=e.split(":"))[0]="wss",e=t.join(":")),this._wsuri=e,this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=n(this._on_socket_open,this),this.socket.onmessage=n(this._on_socket_message,this),this.socket.onerror=n(this._on_socket_error,this),this.socket.onclose=n(this._on_socket_close,this),this.sendPinger=new i(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new i(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new o(this,window,this.connectOptions.timeout,this._disconnected,[R.CONNECT_TIMEOUT.code,M(R.CONNECT_TIMEOUT)])},L.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&null===this.reconnector&&this._process_queue()},L.prototype.store=function(e,t){var n={type:t.type,messageIdentifier:t.messageIdentifier,version:1};if(t.type!==g)throw Error(M(R.INVALID_STORED_DATA,[key,n]));t.pubRecReceived&&(n.pubRecReceived=!0),n.payloadMessage={};for(var i="",s=t.payloadMessage.payloadBytes,o=0;o<s.length;o++)s[o]<=15?i=i+"0"+s[o].toString(16):i+=s[o].toString(16);n.payloadMessage.payloadHex=i,n.payloadMessage.qos=t.payloadMessage.qos,n.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(n.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(n.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),n.sequence=t.sequence),localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(n))},L.prototype.restore=function(e){var t=localStorage.getItem(e),n=JSON.parse(t),i=new f(n.type,n);if(n.type!==g)throw Error(M(R.INVALID_STORED_DATA,[e,t]));for(var s=n.payloadMessage.payloadHex,t=new ArrayBuffer(s.length/2),o=new Uint8Array(t),r=0;2<=s.length;){var a=parseInt(s.substring(0,2),16),s=s.substring(2,s.length);o[r++]=a}t=new Paho.MQTT.Message(o);t.qos=n.payloadMessage.qos,t.destinationName=n.payloadMessage.destinationName,n.payloadMessage.duplicate&&(t.duplicate=!0),n.payloadMessage.retained&&(t.retained=!0),i.payloadMessage=t,0==e.indexOf("Sent:"+this._localKey)?(i.payloadMessage.duplicate=!0,this._sentMessages[i.messageIdentifier]=i):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[i.messageIdentifier]=i)},L.prototype._process_queue=function(){for(var e,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},L.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,(this._sentMessages[e.messageIdentifier]=e).type===g&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},L.prototype._on_socket_open=function(){var e=new f(l,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},L.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data);for(var t=this._deframeMessages(e.data),n=0;n<t.length;n+=1)this._handleMessage(t[n])},L.prototype._deframeMessages=function(e){var t=new Uint8Array(e);this.receiveBuffer&&((e=new Uint8Array(this.receiveBuffer.length+t.length)).set(this.receiveBuffer),e.set(t,this.receiveBuffer.length),t=e,delete this.receiveBuffer);try{for(var n=0,i=[];n<t.length;){var s=function(e,t){var n,i=t,s=e[t],o=s>>4,r=s&=15,a=(t+=1,0),c=1;do{if(t==e.length)return[null,i]}while(a+=(127&(n=e[t++]))*c,c*=128,0!=(128&n));var h=t+a;if(h>e.length)return[null,i];var u=new f(o);switch(o){case p:1&e[t++]&&(u.sessionPresent=!0),u.returnCode=e[t++];break;case g:var l=r>>1&3,d=C(e,t),_=D(e,t+=2,d),d=(t+=d,0<l&&(u.messageIdentifier=C(e,t),t+=2),new Paho.MQTT.Message(e.subarray(t,h)));1==(1&r)&&(d.retained=!0),8==(8&r)&&(d.duplicate=!0),d.qos=l,d.destinationName=_,u.payloadMessage=d;break;case m:case v:case b:case E:case S:u.messageIdentifier=C(e,t);break;case y:u.messageIdentifier=C(e,t),u.returnCode=e.subarray(t+=2,h)}return[u,h]}(t,n),o=s[0],n=s[1];if(null===o)break;i.push(o)}n<t.length&&(this.receiveBuffer=t.subarray(n))}catch(e){return void this._disconnected(R.INTERNAL_ERROR.code,M(R.INTERNAL_ERROR,[e.message,e.stack.toString()]))}return i},L.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case p:if(this._connectTimeout.cancel(),this._connectTimeout=null,this.connectOptions.cleanSession){for(var t in this._sentMessages){var n=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+n.messageIdentifier)}for(var t in this._sentMessages={},this._receivedMessages){var i=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+i.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode)this._disconnected(R.CONNACK_RETURNCODE.code,M(R.CONNACK_RETURNCODE,[e.returnCode,w[e.returnCode]]));else{this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var s,o=new Array;for(s in this._sentMessages)this._sentMessages.hasOwnProperty(s)&&o.push(this._sentMessages[s]);for(var o=o.sort(function(e,t){return e.sequence-t.sequence}),r=0,a=o.length;r<a;r++)(n=o[r]).type==g&&n.pubRecReceived?(u=new f(b,{messageIdentifier:n.messageIdentifier}),this._schedule_message(u)):this._schedule_message(n);if(this.reconnector){for(var c,h=this._buffered_queue.reverse();c=h.pop();)0<((e=new f(g)).payloadMessage=c).qos?this._requires_ack(e):this.onMessageDelivered&&(this._notify_msg_sent[e]=this.onMessageDelivered(e.payloadMessage)),this._schedule_message(e);this._buffered_queue=[]}this.connectOptions.onSuccess&&null==this.reconnector&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),reconnect=!1,this.connectOptions.reconnect&&this.reconnector&&(reconnect=!0,this.reconnector.cancel(),this.reconnector=null,this.onConnected&&this.onConnected({reconnect:reconnect,uri:this._wsuri})),this._process_queue()}break;case g:this._receivePublish(e);break;case m:(n=this._sentMessages[e.messageIdentifier])&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage));break;case v:var u;(n=this._sentMessages[e.messageIdentifier])&&(n.pubRecReceived=!0,u=new f(b,{messageIdentifier:e.messageIdentifier}),this.store("Sent:",n),this._schedule_message(u));break;case b:var i=this._receivedMessages[e.messageIdentifier],l=(localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),i&&(this._receiveMessage(i),delete this._receivedMessages[e.messageIdentifier]),new f(E,{messageIdentifier:e.messageIdentifier}));this._schedule_message(l);break;case E:n=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage);break;case y:(n=this._sentMessages[e.messageIdentifier])&&(n.timeOut&&n.timeOut.cancel(),128===e.returnCode[0]?n.onFailure&&n.onFailure(e.returnCode):n.onSuccess&&n.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case S:(n=this._sentMessages[e.messageIdentifier])&&(n.timeOut&&n.timeOut.cancel(),n.callback&&n.callback(),delete this._sentMessages[e.messageIdentifier]);break;case A:this.sendPinger.reset();break;default:this._disconnected(R.INVALID_MQTT_MESSAGE_TYPE.code,M(R.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){this._disconnected(R.INTERNAL_ERROR.code,M(R.INTERNAL_ERROR,[e.message,e.stack.toString()]))}},L.prototype._on_socket_error=function(e){this._disconnected(R.SOCKET_ERROR.code,M(R.SOCKET_ERROR,[e.data]))},L.prototype._on_socket_close=function(){this._disconnected(R.SOCKET_CLOSE.code,M(R.SOCKET_CLOSE))},L.prototype._socket_send=function(e){var t;1==e.type?(t=this._traceMask(e,"password"),this._trace("Client._socket_send",t)):this._trace("Client._socket_send",e),this.socket.send(e.encode()),this.sendPinger.reset()},L.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new f(m,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);t=new f(v,{messageIdentifier:e.messageIdentifier});this._schedule_message(t);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},L.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},L.prototype._connected=function(e,t){this.onConnected&&this.onConnected({reconnect:e,uri:t})},L.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t,new Date),this.connected&&e===R.CONNECT_TIMEOUT.code||(this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this.reconnector||(this._msg_queue=[],this._notify_msg_sent={}),this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=R.OK.code,t=M(R.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&(reconnect=!1,this.connectOptions.reconnect&&(reconnect=this.connectOptions.reconnect),this.onConnectionLost({errorCode:e,errorMessage:t,reconnect:reconnect,uri:this._wsuri})),e!==R.OK.code&&this.connectOptions.reconnect&&(this._trace("Client._disconnected","starting auto reconnect"),this.reconnector=new s(this,window,this.connectOptions.reconnectInterval),this.reconnector.reset())):this.reconnector?this._trace("Client._disconnected","auto reconnect is already in progress",new Date):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t})))},L.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)void 0!==arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,n=arguments.length;e<n;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e||void 0===arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))},L.prototype._traceMask=function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=n==t?"******":e[n]);return i};t.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnected(){return this._getOnConnected()},set onConnected(e){this._setOnConnected(e)},get disconnectedPublishing(){return this._getDisconnectedPublishing()},set disconnectedPublishing(e){this._setDisconnectedPublishing(e)},get disconnectedBufferSize(){return this._getDisconnectedBufferSize()},set disconnectedBufferSize(e){this._setDisconnectedBufferSize(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var k=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw M(R.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:D(t,0,t.length)},this._getPayloadBytes=function(){var e;return"string"==typeof t?(e=new ArrayBuffer(P(t)),e=new Uint8Array(e),c(t,e,0),e):t};var n=void 0,i=(this._getDestinationName=function(){return n},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(M(R.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e},0),s=(this._getQos=function(){return i},!(this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);i=e})),o=(this._getRetained=function(){return s},!(this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(M(R.INVALID_ARGUMENT,[e,"newRetained"]));s=e}));this._getDuplicate=function(){return o},this._setDuplicate=function(e){o=e}};return k.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:t,Message:k}}(window);var webduino=webduino||{version:"0.6.0"},chrome=("undefined"!=typeof exports&&(module.exports=webduino),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n="DEBUG_WEBDUINOJS";e.Logger=function(e){this._option=e="string"==typeof(e=e||"*")?{key:e}:e,this._key=e.key,this._isShow=function(){var e,t=[];!function(){try{return localStorage}catch(e){}}()||(e=localStorage.getItem(n));!function(){try{return process}catch(e){}}()||(e=process.env[n]);e&&(t=e.split(",").map(function(e){return e.trim()}));return!(!e||-1===t.indexOf("*")&&-1===t.indexOf(this._key))}.bind(this),function(){function t(){}var n=this,i=this._isShow();["log","info","warn","error"].forEach(function(e){n[e]=i?Function.prototype.bind.call(console[e],console):t})}.call(this)}}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t;function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}(t=n.prototype)._events=void 0,t._maxListeners=void 0,n.defaultMaxListeners=10,t.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.emit=function(e){var t,n,i,s,o;if(this._events||(this._events={}),c(t=this._events[e]))return!1;if(r(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),t.apply(this,i)}else if(a(t))for(i=Array.prototype.slice.call(arguments,1),n=(o=t.slice()).length,s=0;s<n;s++)o[s].apply(this,i);return!0},t.addListener=function(e,t){if(r(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(t=c(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<t&&this._events[e].length>t&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this;throw TypeError("listener must be a function")},t.on=t.addListener,t.once=function(e,t){var n;if(r(t))return n=!1,i.listener=t,this.on(e,i),this;throw TypeError("listener must be a function");function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}},t.removeListener=function(e,t){var n,i,s,o;if(!r(t))throw TypeError("listener must be a function");if(this._events&&this._events[e])if(s=(n=this._events[e]).length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(o=s;0<o--;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.removeAllListeners=function(e){var t,n;if(this._events)if(this._events.removeListener)if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);this.removeAllListeners("removeListener"),this._events={}}else{if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);delete this._events[e]}else 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e];return this},t.listeners=function(e){e=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},n.listenerCount=function(e,t){e=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0;return e},e.EventEmitter=n}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n="undefined"==typeof exports,t=Object.prototype.toString;function u(e){return"function"==typeof e}function i(e){return"[object Object]"===t.call(e)}function l(e){return i(e)&&e.constructor===Object&&!e.nodeType&&!e.setInterval}function d(e){return Array.isArray(e)}e.util={isFn:u,isFunction:u,isObject:i,isHash:l,isArray:d,extend:function e(){var t,n,i,s,o,r=arguments[0]||{},a=1,c=arguments.length,h=!1;for("boolean"==typeof r&&(h=r,r=arguments[1]||{},a=2),"object"==typeof r||u(r)||(r={});a<c;a++)if(null!==(t=arguments[a]))for(n in t="string"==typeof t?t.split(""):t)o=r[n],r!==(i=t[n])&&(h&&i&&(l(i)||(s=d(i)))?(o=s?(s=!1,o&&d(o)?o:[]):o&&l(o)?o:{},r[n]=e(h,o,i)):void 0!==i&&(r[n]=i));return r},parseURL:function(e){var t;return n?((t=document.createElement("a")).href=e,t):require("url").parse(e)},randomId:function(){return(Math.random()*Date.now()).toString(36).replace(/\./g,"")}}}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";function r(e,t,n){this.resolve=e,this.reject=t,this.custom=n}e.util.promisify=function(s,o){return function(){var n=this,i=Array.prototype.slice.call(arguments);return new Promise(function(e,t){e=new r(e,t,o);i.push(function(e,t,n){if("function"==typeof e.custom){var i=function(){return e.custom.apply(i,arguments)};i.resolve=e.resolve,i.reject=e.reject,i.call(null,t,n)}else{if(t)return e.reject(t);e.resolve(n)}}.bind(null,e)),s.apply(n,i)})}}}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.EventEmitter;function i(e){n.call(this)}i.prototype=t=Object.create(n.prototype,{constructor:{value:i},isOpen:{value:!1}}),t.send=function(e){throw new Error("direct call on abstract method.")},t.close=function(){throw new Error("direct call on abstract method.")},t.flush=function(){throw new Error("direct call on abstract method.")},e.TransportEvent={OPEN:"open",MESSAGE:"message",ERROR:"error",CLOSE:"close",REOPEN:"reopen"},e.Transport=i,e.transport=e.transport||{}}),!function(e){"use strict";var t,n=Array.prototype.push,i=e.Transport,s=e.TransportEvent,o=e.util,r={OK:"OK"},a={PING:"/PING",PONG:"/PONG",STATUS:"/STATUS"};function c(e){i.call(this,e),this._options=e,this._client=null,this._timer=null,this._sendTimer=null,this._buf=[],this._status="",this._connHandler=function(){this._client.subscribe(this._options.device+a.PONG),this._client.subscribe(this._options.device+a.STATUS)}.bind(this),this._connFailedHandler=function(e){this.emit(s.ERROR,new Error(e.errorMessage))}.bind(this),this._messageHandler=function(e){var t=e.destinationName,n=this._status;"STATUS"===t.substr(t.lastIndexOf("/")+1)?(this._status=e.payloadString,function(e,t,n){t===n?t===r.OK&&e.emit(s.REOPEN):t===r.OK?e.emit(s.OPEN):e.emit(s.ERROR,new Error("board connection failed."))}(this,this._status,n)):this._status===r.OK&&this.emit(s.MESSAGE,e.payloadBytes)}.bind(this),this._sendOutHandler=function(){var e=new Paho.MQTT.Message(new Uint8Array(this._buf).buffer);e.destinationName=this._options.device+a.PING,e.qos=0,this.isOpen&&this._client.send(e),function(e){e._buf=[],clearImmediate(e._sendTimer),e._sendTimer=null}(this)}.bind(this),this._disconnHandler=function(e){e.errorCode&&e.reconnect||(delete this._client,e.errorCode&&this.emit(s.ERROR,new Error(e.errorMessage)),this.emit(s.CLOSE))}.bind(this),(e=this)._client=new Paho.MQTT.Client(e._options.server,"_"+e._options.device+(e._options.multi?"."+o.randomId():"")),e._client.onMessageArrived=e._messageHandler,e._client.onConnectionLost=e._disconnHandler,e._client.onConnected=e._connHandler,e._client.connect({userName:e._options.login||"",password:e._options.password||"",timeout:c.CONNECT_TIMEOUT,keepAliveInterval:c.KEEPALIVE_INTERVAL,onSuccess:e._connHandler,onFailure:e._connFailedHandler,reconnect:!!e._options.autoReconnect,reconnectInterval:c.RECONNECT_PERIOD})}c.prototype=t=Object.create(i.prototype,{constructor:{value:c},isOpen:{get:function(){return this._client&&this._client.isConnected()}}}),t.send=function(e){this._buf.length+e.length+this._options.device.length+a.PING.length+4>c.MAX_PACKET_SIZE&&this._sendOutHandler(),n.apply(this._buf,e),this._sendTimer||(this._sendTimer=setImmediate(this._sendOutHandler))},t.close=function(){this._client&&(this._client.isConnected()?this._client.disconnect():delete this._client)},t.flush=function(){this._buf&&this._buf.length&&this._sendOutHandler()},c.RECONNECT_PERIOD=1,c.KEEPALIVE_INTERVAL=15,c.CONNECT_TIMEOUT=30,c.MAX_PACKET_SIZE=128,e.transport.mqtt=c}(webduino),!function(e){"use strict";var t,n=Array.prototype.push,i=WebSocket,s=e.Transport,o=e.TransportEvent;function r(e){var t;s.call(this,e),this._options=e,this._client=null,this._sendTimer=null,this._buf=[],this._connHandler=function(e){this.emit(o.OPEN,e)}.bind(this),this._messageHandler=function(e){this.emit(o.MESSAGE,new Uint8Array(e.data))}.bind(this),this._sendOutHandler=function(){var e=new Uint8Array(this._buf).buffer;this.isOpen&&this._client.send(e),function(e){e._buf=[],clearImmediate(e._sendTimer),e._sendTimer=null}(this)}.bind(this),this._disconnHandler=function(e){delete this._client,this.emit(o.CLOSE,e)}.bind(this),this._errorHandler=function(e){this.emit(o.ERROR,e)}.bind(this),t=(e=this)._options.url,e._options.url=0===t.indexOf("ws://")?t:"ws://"+t,e._client=new i(e._options.url),e._client.binaryType="arraybuffer",e._client.onopen=e._connHandler,e._client.onmessage=e._messageHandler,e._client.onclose=e._disconnHandler,e._client.onerror=e._errorHandler}r.prototype=t=Object.create(s.prototype,{constructor:{value:r},isOpen:{get:function(){return this._client&&this._client.readyState===i.OPEN}}}),t.send=function(e){this._buf.length+e.length>r.MAX_PACKET_SIZE&&this._sendOutHandler(),n.apply(this._buf,e),this._sendTimer||(this._sendTimer=setImmediate(this._sendOutHandler))},t.close=function(){this._client&&(this._client.readyState===i.OPEN?this._client.close():delete this._client)},t.flush=function(){this._buf&&this._buf.length&&this._sendOutHandler()},r.MAX_PACKET_SIZE=64,e.transport.websocket=r}(webduino),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.EventEmitter,n={CHANGE:"change",RISING_EDGE:"risingEdge",FALLING_EDGE:"fallingEdge"};function o(e,t,n){i.call(this),this._board=e,this._type=n,this._capabilities={},this._number=t,this._analogNumber=void 0,this._analogWriteResolution=255,this._analogReadResolution=1023,this._value=0,this._lastValue=-1,this._preFilterValue=0,this._average=0,this._minimum=Math.pow(2,16),this._maximum=0,this._sum=0,this._numSamples=0,this._filters=null,this._generator=null,this._state=void 0,this._analogReporting=!1,this._sendOutHandler=function(e){var t=e._type,n=e._number,i=e._board,s=e.value;switch(t){case o.DOUT:i.sendDigitalData(n,s);break;case o.AOUT:i.sendAnalogData(n,s);break;case o.SERVO:i.sendServoData(n,s)}}.bind(this),this._autoSetValueCallback=this.autoSetValue.bind(this),s(this)}function s(e){var t=e._type;if(t===o.DOUT||t===o.AOUT||t===o.SERVO)i.listenerCount(e,n.CHANGE)||e.on(n.CHANGE,e._sendOutHandler);else if(i.listenerCount(e,n.CHANGE))try{e.removeListener(n.CHANGE,e._sendOutHandler)}catch(e){console.error("debug: caught self removeEventListener exception")}}o.prototype=t=Object.create(i.prototype,{constructor:{value:o},capabilities:{get:function(){return this._capabilities}},analogNumber:{get:function(){return this._analogNumber}},number:{get:function(){return this._number}},analogWriteResolution:{get:function(){return this._analogWriteResolution}},analogReadResolution:{get:function(){return this._analogReadResolution}},state:{get:function(){return this._state},set:function(e){this._type===o.PWM&&(e/=this._analogWriteResolution),this.value=this._value=this._state=e}},type:{get:function(){return this._type}},average:{get:function(){return this._average}},minimum:{get:function(){return this._minimum}},maximum:{get:function(){return this._maximum}},value:{get:function(){return this._value},set:function(e){this._lastValue=this._value,this._preFilterValue=e,this._value=this.applyFilters(e),this.calculateMinMaxAndMean(this._value),this.detectChange(this._lastValue,this._value)}},lastValue:{get:function(){return this._lastValue}},preFilterValue:{get:function(){return this._preFilterValue}},filters:{get:function(){return this._filters},set:function(e){this._filters=e}},generator:{get:function(){return this._generator}}}),t.setAnalogNumber=function(e){this._analogNumber=e},t.setAnalogWriteResolution=function(e){this._analogWriteResolution=e},t.setAnalogReadResolution=function(e){this._analogReadResolution=e},t.setCapabilities=function(e){this._capabilities=e;var e=this._capabilities[o.PWM],t=this._capabilities[o.AIN];e&&(this._analogWriteResolution=Math.pow(2,e)-1),t&&(this._analogReadResolution=Math.pow(2,t)-1)},t.setMode=function(e,t){var n=this._number,i=this._board;0<=e&&e<o.TOTAL_PIN_MODES&&(this._type=e,s(this),t&&!0===t||i.setPinMode(n,e))},t.detectChange=function(e,t){e!==t&&(this.emit(n.CHANGE,this),e<=0&&0!==t?this.emit(n.RISING_EDGE,this):0!==e&&t<=0&&this.emit(n.FALLING_EDGE,this))},t.clearWeight=function(){this._sum=this._average,this._numSamples=1},t.calculateMinMaxAndMean=function(e){var t=Number.MAX_VALUE;this._minimum=Math.min(e,this._minimum),this._maximum=Math.max(e,this._maximum),this._sum+=e,this._average=this._sum/++this._numSamples,this._numSamples>=t&&this.clearWeight()},t.clear=function(){this._minimum=this._maximum=this._average=this._lastValue=this._preFilterValue,this.clearWeight()},t.addFilter=function(e){null!==e&&(null===this._filters&&(this._filters=[]),this._filters.push(e))},t.removeFilter=function(e){this._filters.length<1||-1!==(e=this._filters.indexOf(e))&&this._filters.splice(e,1)},t.addGenerator=function(e){this.removeGenerator(),this._generator=e,this._generator.on("update",this._autoSetValueCallback)},t.removeGenerator=function(){null!==this._generator&&this._generator.removeListener("update",this._autoSetValueCallback),delete this._generator},t.removeAllFilters=function(){delete this._filters},t.autoSetValue=function(e){this.value=e},t.applyFilters=function(e){if(null===this._filters)return e;for(var t=e,n=this._filters.length,i=0;i<n;i++)t=this._filters[i].processSample(t);return t},t.read=function(){var e=this._type,t=this._board,n=this;switch(e){case o.DOUT:case o.AOUT:case o.SERVO:return t.queryPinState(n._number).then(function(e){return e.state});case o.AIN:return n._analogReporting||t.enableAnalogPin(n._analogNumber),new Promise(function(e){setImmediate(function(){e(n.value)})});case o.DIN:return new Promise(function(e){setImmediate(function(){e(n.value)})})}},t.write=function(e){var t=this._type;t!==o.DOUT&&t!==o.AOUT&&t!==o.SERVO||(this.value=e)},o.HIGH=1,o.LOW=0,o.ON=1,o.OFF=0,o.DIN=0,o.DOUT=1,o.AIN=2,o.AOUT=3,o.PWM=3,o.SERVO=4,o.SHIFT=5,o.I2C=6,o.ONEWIRE=7,o.STEPPER=8,o.TOTAL_PIN_MODES=9,e.PinEvent=n,e.Pin=o}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t=e.EventEmitter;function n(){t.call(this)}n.prototype=Object.create(t.prototype,{constructor:{value:n},type:{get:function(){return this._type}}}),e.Module=n,e.module=e.module||{}}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(n){"use strict";var e,r=Array.prototype.push,t=n.EventEmitter,i=n.TransportEvent,s=n.Logger,h=n.Pin,a=n.util,u={ANALOG_DATA:"analogData",DIGITAL_DATA:"digitalData",FIRMWARE_VERSION:"firmwareVersion",FIRMWARE_NAME:"firmwareName",STRING_MESSAGE:"stringMessage",SYSEX_MESSAGE:"sysexMessage",PIN_STATE_RESPONSE:"pinStateResponse",READY:"ready",ERROR:"error",BEFOREDISCONNECT:"beforeDisconnect",DISCONNECT:"disconnect",RECONNECT:"reconnect"},c=240,l=247;function o(e){t.call(this),this._options=e,this._buf=[],this._digitalPort=[],this._numPorts=0,this._analogPinMapping=[],this._digitalPinMapping=[],this._i2cPins=[],this._ioPins=[],this._totalPins=0,this._totalAnalogPins=0,this._samplingInterval=19,this._isReady=!1,this._firmwareName="",this._firmwareVersion=0,this._capabilityQueryResponseReceived=!1,this._numPinStateRequests=0,this._numDigitalPortReportRequests=0,this._transport=null,this._pinStateEventCenter=new t,this._logger=new s("Board"),this._sendingInterval=0,this._sendingRec=[],this._initialVersionResultHandler=function(e){{if(!(23<=10*e.version))throw new Error("You must upload StandardFirmata version 2.3 or greater from Arduino version 1.0 or higher");this.queryCapabilities()}}.bind(this),this._openHandler=function(){this._logger.info("onOpen","Device online"),this.begin()}.bind(this),this._reOpenHandler=function(){this._logger.info("onReOpen","Device re-online"),this.emit(u.RECONNECT)}.bind(this),this._messageHandler=function(e){try{this._logger.info("onMessage",e);var t=e.length;if(t)for(var n=0;n<t;n++)this.processInput(e[n]);else this.processInput(e)}catch(e){throw console.error(e),e}}.bind(this),this._errorHandler=function(e){this._logger.warn("onError",e),this._isReady=!1,this.emit(u.ERROR,e),setImmediate(this.disconnect.bind(this))}.bind(this),this._closeHandler=function(){this._isReady=!1,this._transport.removeAllListeners(),delete this._transport,this.emit(u.DISCONNECT)}.bind(this),this._cleanupHandler=function(){this.disconnect()}.bind(this),e=this,"undefined"==typeof exports?window.addEventListener("beforeunload",e._cleanupHandler):process.addListener("uncaughtException",e._cleanupHandler),this._setTransport(this._options.transport)}o.prototype=e=Object.create(t.prototype,{constructor:{value:o},samplingInterval:{get:function(){return this._samplingInterval},set:function(e){if(!(o.MIN_SAMPLING_INTERVAL<=e&&e<=o.MAX_SAMPLING_INTERVAL))throw new Error("warning: Sampling interval must be between "+o.MIN_SAMPLING_INTERVAL+" and "+o.MAX_SAMPLING_INTERVAL);this._samplingInterval=e,this.send([c,122,127&e,e>>7&127,l])}},sendingInterval:{get:function(){return this._sendingInterval},set:function(e){"number"==typeof e&&(this._sendingInterval=e<0?0:e)}},isReady:{get:function(){return this._isReady}},isConnected:{get:function(){return this._transport&&this._transport.isOpen}}}),e.begin=function(){this.once(u.FIRMWARE_NAME,this._initialVersionResultHandler),this.reportFirmware()},e.processInput=function(e){var t,n;this._buf.push(e),t=this._buf.length,128<=(n=this._buf[0])&&n!==c?3===t&&(this.processMultiByteCommand(this._buf),this._buf=[]):n===c&&e===l?(this.processSysexCommand(this._buf),this._buf=[]):128<=e&&n<128&&(this._buf=[],e!==l&&this._buf.push(e))},e.processMultiByteCommand=function(e){var t,n=e[0];switch(n<240&&(n&=240,t=15&e[0]),n){case 144:this._logger.info("processMultiByteCommand digital:",t,e[1],e[2]),this._options.handleDigitalPins&&this.processDigitalMessage(t,e[1],e[2]);break;case 249:this._firmwareVersion=e[1]+e[2]/10,this.emit(u.FIRMWARE_VERSION,{version:this._firmwareVersion});break;case 224:this._logger.info("processMultiByteCommand analog:",t,e[1],e[2]),this.processAnalogMessage(t,e[1],e[2])}},e.processDigitalMessage=function(e,t,n){for(var i,e=8*e,s=8+e,o=t|n<<7,r={},a=(s>=this._totalPins&&(s=this._totalPins),0),c=e;c<s;c++){if(void 0===(r=this.getDigitalPin(c)))return;r.type===h.DIN&&(i=o>>a&1)!==r.value&&(r.value=i,this.emit(u.DIGITAL_DATA,{pin:r})),a++}this._isReady||(this._numDigitalPortReportRequests--,this._numDigitalPortReportRequests<=0&&this.startup())},e.processAnalogMessage=function(e,t,n){e=this.getAnalogPin(e);void 0!==e&&(e.value=this.getValueFromTwo7bitBytes(t,n)/e.analogReadResolution,e.value!==e.lastValue&&(this._isReady&&(e._analogReporting=!0),this.emit(u.ANALOG_DATA,{pin:e})))},e.processSysexCommand=function(e){switch(e.shift(),e.pop(),e[0]){case 121:this.processQueryFirmwareResult(e);break;case 113:this.processSysExString(e);break;case 108:this.processCapabilitiesResponse(e);break;case 110:this.processPinStateResponse(e);break;case 106:this.processAnalogMappingResponse(e);break;default:this.emit(u.SYSEX_MESSAGE,{message:e})}},e.processQueryFirmwareResult=function(e){for(var t,n=3,i=e.length;n<i;n+=2)t=e[n],t+=e[n+1],this._firmwareName+=String.fromCharCode(t);this._firmwareVersion=e[1]+e[2]/10,this.emit(u.FIRMWARE_NAME,{name:this._firmwareName,version:this._firmwareVersion})},e.processSysExString=function(e){for(var t,n="",i=e.length,s=1;s<i;s+=2)t=e[s],t+=e[s+1],n+=String.fromCharCode(t);this.emit(u.STRING_MESSAGE,{message:n})},e.processCapabilitiesResponse=function(e){var t,n={},i=1,s=0,o=0,r=e.length;for(this._capabilityQueryResponseReceived=!0;i<=r;)127===e[i]?(this._digitalPinMapping[s]=s,t=void 0,n[h.DOUT]&&(t=h.DOUT),n[h.AIN]&&(t=h.AIN,this._analogPinMapping[o++]=s),(t=new h(this,s,t)).setCapabilities(n),(this._ioPins[s]=t)._capabilities[h.I2C]&&this._i2cPins.push(t.number),n={},s++,i++):(n[e[i]]=e[i+1],i+=2);this._numPorts=Math.ceil(s/8);for(var a=0;a<this._numPorts;a++)this._digitalPort[a]=0;this._totalPins=s,this._totalAnalogPins=o,this.queryAnalogMapping()},e.processAnalogMappingResponse=function(e){for(var t=e.length,n=1;n<t;n++)127!==e[n]&&(this._analogPinMapping[e[n]]=n-1,this.getPin(n-1).setAnalogNumber(e[n]));this._isReady||(this._options.initialReset&&this.systemReset(),this._options.handleDigitalPins?this.enableDigitalPins():this.startup())},e.startup=function(){this._logger.info("startup","Board Ready"),this._isReady=!0,this.emit(u.READY,this)},e.systemReset=function(){this.send([255])},e.processPinStateResponse=function(e){var t,n,i,s,o;this._numPinStateRequests<=0||(t=e.length,n=e[1],i=e[2],o=this._ioPins[n],4<t?s=this.getValueFromTwo7bitBytes(e[3],e[4]):3<t&&(s=e[3]),o.type!==i&&o.setMode(i,!0),o.state=s,this._numPinStateRequests--,this._numPinStateRequests<0&&(this._numPinStateRequests=0),this._pinStateEventCenter.emit(n,o),this.emit(u.PIN_STATE_RESPONSE,{pin:o}))},e.toDec=function(e){return(e=e.substring(0,1)).charCodeAt(0)},e.sendAnalogData=function(e,t){var n=this.getDigitalPin(e).analogWriteResolution;t=n<(t=(t*=n)<0?0:t)?n:t,15<e||t>Math.pow(2,14)?this.sendExtendedAnalogData(e,t):this.send([224|15&e,127&t,t>>7&127])},e.sendExtendedAnalogData=function(e,t){var n=[];if(t>Math.pow(2,16))throw new Error("Extended Analog values > 16 bits are not currently supported by StandardFirmata");n[0]=c,n[1]=111,n[2]=e,n[3]=127&t,n[4]=t>>7&127,t>=Math.pow(2,14)&&(n[5]=t>>14&127),n.push(l),this.send(n)},e.sendDigitalData=function(e,t){try{var n=Math.floor(e/8);if(t===h.HIGH)this._digitalPort[n]|=t<<e%8;else{if(t!==h.LOW)throw new Error("Invalid value passed to sendDigital, value must be 0 or 1.");this._digitalPort[n]&=~(1<<e%8)}this.sendDigitalPort(n,this._digitalPort[n])}catch(e){console.error("Board -> sendDigitalData, msg:",e.message,"value:",t),this.emit(u.ERROR,e),setImmediate(this.disconnect.bind(this))}},e.sendServoData=function(e,t){var n=this.getDigitalPin(e);n.type===h.SERVO&&n.lastValue!==t&&this.sendAnalogData(e,t)},e.queryCapabilities=function(){this._logger.info("queryCapabilities"),this.send([c,107,l])},e.queryAnalogMapping=function(){this._logger.info("queryAnalogMapping"),this.send([c,105,l])},e.getValueFromTwo7bitBytes=function(e,t){return t<<7|e},e.getTransport=function(){return this._transport},e._setTransport=function(e){var t=e;(t="string"==typeof e?n.transport[e]:t)&&(e=new t(this._options))&&(e.on(i.OPEN,this._openHandler),e.on(i.MESSAGE,this._messageHandler),e.on(i.ERROR,this._errorHandler),e.on(i.CLOSE,this._closeHandler),e.on(i.REOPEN,this._reOpenHandler),this._transport=e)},e.reportVersion=function(){this.send(249)},e.reportFirmware=function(){this._logger.info("reportFirmware"),this.send([c,121,l])},e.enableDigitalPins=function(){this._logger.info("enableDigitalPins");for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,h.ON)},e.disableDigitalPins=function(){for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,h.OFF)},e.sendDigitalPortReporting=function(e,t){this._isReady||this._numDigitalPortReportRequests++,this.send([208|e,t])},e.enableAnalogPin=function(e){this.sendAnalogPinReporting(e,h.ON),this.getAnalogPin(e)._analogReporting=!0},e.disableAnalogPin=function(e){this.sendAnalogPinReporting(e,h.OFF),this.getAnalogPin(e)._analogReporting=!1},e.sendAnalogPinReporting=function(e,t){this.send([192|e,t])},e.setDigitalPinMode=function(e,t,n){this.getDigitalPin(e).setMode(t,n)},e.setAnalogPinMode=function(e,t,n){this.getAnalogPin(e).setMode(t,n)},e.setPinMode=function(e,t){this.send([244,e,t])},e.enablePullUp=function(e){this.sendDigitalData(e,h.HIGH)},e.getFirmwareName=function(){return this._firmwareName},e.getFirmwareVersion=function(){return this._firmwareVersion},e.getPinCapabilities=function(){for(var e,t,n,i=[],s={0:"input",1:"output",2:"analog",3:"pwm",4:"servo",5:"shift",6:"i2c",7:"onewire",8:"stepper"},o=this._ioPins.length,r=0;r<o;r++){for(var a in n=!(e={}),t=this._ioPins[r]._capabilities)t.hasOwnProperty(a)&&(n=!0,0<=a&&(e[s[a]]=this._ioPins[r]._capabilities[a]));i[r]=n?e:{"not available":"0"}}return i},e.queryPinState=function(e,t){var n=this,i=[],s=[],o=n._pinStateEventCenter.once.bind(n._pinStateEventCenter);if((e=(e=a.isArray(e)?e:[e]).map(function(e){return e instanceof h?e:n.getPin(e)})).forEach(function(e){i.push(a.promisify(o,function(e){this.resolve(e)})(e.number)),r.apply(s,[c,109,e.number,l]),n._numPinStateRequests++}),n.send(s),"function"!=typeof t)return 1<e.length?i:i[0];Promise.all(i).then(function(e){t.call(n,1<e.length?e:e[0])})},e.sendDigitalPort=function(e,t){this.send([144|15&e,127&t,t>>7])},e.sendString=function(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(127&this.toDec(e[n])),t.push(this.toDec(e[n])>>7&127);this.sendSysex(113,t)},e.sendSysex=function(e,t){var n=[];n[0]=c,n[1]=e;for(var i=0,s=t.length;i<s;i++)n.push(t[i]);n.push(l),this.send(n)},e.sendServoAttach=function(e,t,n){var i=[];t=t||544,n=n||2400,i[0]=c,i[1]=112,i[2]=e,i[3]=t%128,i[4]=t>>7,i[5]=n%128,i[6]=n>>7,i[7]=l,this.send(i),this.getDigitalPin(e).setMode(h.SERVO,!0)},e.getPin=function(e){return this._ioPins[e]},e.getAnalogPin=function(e){return this._ioPins[this._analogPinMapping[e]]},e.getDigitalPin=function(e){return this._ioPins[this._digitalPinMapping[e]]},e.getPins=function(){return this._ioPins},e.analogToDigital=function(e){return this.getAnalogPin(e).number},e.getPinCount=function(){return this._totalPins},e.getAnalogPinCount=function(){return this._totalAnalogPins},e.getI2cPins=function(){return this._i2cPins},e.reportCapabilities=function(){for(var e,t=this.getPinCapabilities(),n=t.length,i=0;i<n;i++)for(var s in this._logger.info("reportCapabilities, Pin "+i),t[i])t[i].hasOwnProperty(s)&&(e=t[i][s],this._logger.info("reportCapabilities","\t"+s+" ("+e+(1<e?" bits)":" bit)")))},e.send=function(t){if(this.isConnected){if(0!==this.sendingInterval){var e=this._sendingRec.findIndex(function(e){return e.value.toString()===t.toString()});if(-1!==e){if(Date.now()-this._sendingRec[e].timestamp<this.sendingInterval)return;this._sendingRec.splice(e,1)}this._sendingRec.splice(0),this._sendingRec.push({value:t.slice(),timestamp:Date.now()})}this._transport.send(t)}},e.close=function(e){this.disconnect(e)},e.flush=function(){this.isConnected&&this._transport.flush()},e.disconnect=function(e){var t;e=e||function(){},this.isConnected&&this.emit(u.BEFOREDISCONNECT),this._isReady=!1,t=this,"undefined"==typeof exports?window.removeEventListener("beforeunload",t._cleanupHandler):process.removeListener("uncaughtException",t._cleanupHandler),this._transport?this._transport.isOpen?(this.once(u.DISCONNECT,e),this._transport.close()):(this._transport.removeAllListeners(),delete this._transport,e()):e()},o.MIN_SAMPLING_INTERVAL=20,o.MAX_SAMPLING_INTERVAL=15e3,n.BoardEvent=u,n.Board=o,n.board=n.board||{}}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.util,i=e.TransportEvent,s=e.Board;function o(e){"china"===(e="string"==typeof e?{device:e}:e).area&&(e.server=o.SERVER_CHINA),(e=n.extend({transport:"mqtt",server:o.DEFAULT_SERVER,login:"admin",password:"password",autoReconnect:!1,multi:!1,initialReset:!0,handleDigitalPins:!0},e)).server=function(e){-1===e.indexOf("://")&&(e=("undefined"!=typeof location&&"https:"===location.protocol?"wss:":"ws:")+"//"+e);return(e=n.parseURL(e)).protocol+"//"+e.host+"/"}(e.server),s.call(this,e)}function r(e,t){e._transport.emit(i.MESSAGE,t)}o.prototype=t=Object.create(s.prototype,{constructor:{value:o}}),t.reportFirmware=function(){r(this,[240,121,2,4,119,0,101,0,98,0,100,0,117,0,105,0,110,0,111,0,46,0,105,0,110,0,111,0,247])},t.queryCapabilities=function(){r(this,[240,108,127,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,2,10,127,2,10,127,247])},t.queryAnalogMapping=function(){r(this,[240,106,127,127,127,127,127,127,127,127,127,127,127,127,127,127,0,1,2,3,4,5,6,7,247])},o.DEFAULT_SERVER="wss://ws.webduino.io:443",o.SERVER_CHINA="wss://ws.webduino.com.cn",e.WebArduino=o}),!function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.util,i=e.Board,s=e.BoardEvent;function o(e){"string"==typeof e&&(e={transport:"serial",path:e}),e=n.extend({serial:{transport:"serial",baudRate:57600},bluetooth:{transport:"bluetooth",uuid:"1101"}}[e.transport]||{},e),i.call(this,e)}o.prototype=t=Object.create(i.prototype,{constructor:{value:o}}),t.begin=function(){this.once(s.FIRMWARE_NAME,this._initialVersionResultHandler),"serial"!==this._options.transport&&this.reportFirmware()},e.Arduino=o}),chrome||{});chrome._api=function(i){"use strict";var s=Array.prototype.slice,o={},r={},a=0;function c(e,t,n){delete chrome.runtime.lastError,i.postMessage({jsonrpc:"2.0",id:e,method:t,params:n},i.location.origin)}return i.addEventListener("message",function(e){e=e.data;if(e.jsonrpc&&!e.method){if(e.exception)throw o[e.id]&&delete o[e.id],new Error(e.exception);e.error&&(chrome.runtime.lastError={message:e.error}),o[e.id]?(o[e.id].apply(void 0,e.result),delete o[e.id]):r[e.id]&&r[e.id].apply(void 0,e.result)}},!1),{proxyRequest:function(n){return function(){var e=s.call(arguments),t=++a+"";"function"==typeof e[e.length-1]&&(o[t]=e.pop()),c(t,n,e)}},proxyAddListener:function(n){return function(e){var t=++a+"";"function"==typeof e&&(r[t]=e,c(t,n,[]))}},proxyRemoveListener:function(n){return function(t){Object.keys(r).some(function(e){if(r[e]===t)return delete r[e],c(e,n,[]),!0})}}}}(window),chrome.runtime=chrome.runtime||{},chrome.serial=chrome.serial||function(e){"use strict";var i=Array.prototype.slice,t=e.proxyRequest,n=e.proxyAddListener,e=e.proxyRemoveListener,s=t("chrome.serial.send");return{getDevices:t("chrome.serial.getDevices"),connect:t("chrome.serial.connect"),update:t("chrome.serial.update"),disconnect:t("chrome.serial.disconnect"),setPaused:t("chrome.serial.setPaused"),getInfo:t("chrome.serial.getInfo"),getConnections:t("chrome.serial.getConnections"),send:function(e,t,n){s.apply(void 0,[e,i.call(new Uint8Array(t)),n])},flush:t("chrome.serial.flush"),getControlSignals:t("chrome.serial.getControlSignals"),setControlSignals:t("chrome.serial.setControlSignals"),setBreak:t("chrome.serial.setBreak"),clearBreak:t("chrome.serial.clearBreak"),onReceive:{addListener:n("chrome.serial.onReceive.addListener"),removeListener:e("chrome.serial.onReceive.removeListener")},onReceiveError:{addListener:n("chrome.serial.onReceiveError.addListener"),removeListener:e("chrome.serial.onReceiveError.removeListener")}}}(chrome._api),function(e){"use strict";var t,n=Array.prototype.push,i=chrome.serial,s=e.Transport,o=e.TransportEvent;function r(e){var t;s.call(this,e),this._options=e,this._connectionId=null,this._sendTimer=null,this._buf=[],this._connHandler=function(e){this._connectionId=e.connectionId,this.emit(o.OPEN)}.bind(this),this._messageHandler=function(e){e.connectionId===this._connectionId&&this.emit(o.MESSAGE,e.data)}.bind(this),this._sendOutHandler=function(){var e=new Uint8Array(this._buf).buffer;this.isOpen&&i.send(this._connectionId,e),function(e){e._buf=[],clearImmediate(e._sendTimer),e._sendTimer=null}(this)}.bind(this),this._disconnHandler=function(e){i.onReceive.removeListener(this._messageHandler),i.onReceiveError.removeListener(this._errorHandler),delete this._connectionId,this.emit(o.CLOSE)}.bind(this),this._errorHandler=function(e){this.emit(o.ERROR,new Error(JSON.stringify(e)))}.bind(this),t=(e=this)._options,i.onReceive.addListener(e._messageHandler),i.onReceiveError.addListener(e._errorHandler),i.connect(t.path,{bitrate:t.baudRate},e._connHandler)}r.prototype=t=Object.create(s.prototype,{constructor:{value:r},isOpen:{get:function(){return!!this._connectionId}}}),t.send=function(e){n.apply(this._buf,e),this._sendTimer||(this._sendTimer=setImmediate(this._sendOutHandler))},t.close=function(){this._connectionId&&i.disconnect(this._connectionId,this._disconnHandler)},e.transport.serial=r}(webduino),chrome.bluetooth=chrome.bluetooth||function(){"use strict";var e=chrome._api.proxyRequest;return{getAdapterState:e("chrome.bluetooth.getAdapterState"),getDevice:e("chrome.bluetooth.getDevice"),getDevices:e("chrome.bluetooth.getDevices"),startDiscovery:e("chrome.bluetooth.startDiscovery"),stopDiscovery:e("chrome.bluetooth.stopDiscovery")}}(),chrome.bluetoothSocket=chrome.bluetoothSocket||function(e){"use strict";var i=Array.prototype.slice,t=e.proxyRequest,n=e.proxyAddListener,e=e.proxyRemoveListener,s=t("chrome.bluetoothSocket.send");return{create:t("chrome.bluetoothSocket.create"),connect:t("chrome.bluetoothSocket.connect"),update:t("chrome.bluetoothSocket.update"),disconnect:t("chrome.bluetoothSocket.disconnect"),close:t("chrome.bluetoothSocket.close"),setPaused:t("chrome.bluetoothSocket.setPaused"),getInfo:t("chrome.bluetoothSocket.getInfo"),getSockets:t("chrome.bluetoothSocket.getSockets"),send:function(e,t,n){s.apply(void 0,[e,i.call(new Uint8Array(t)),n])},listenUsingRfcomm:t("chrome.bluetoothSocket.listenUsingRfcomm"),listenUsingL2cap:t("chrome.bluetoothSocket.listenUsingL2cap"),onAccept:{addListener:n("chrome.bluetoothSocket.onAccept.addListener"),removeListener:e("chrome.bluetoothSocket.onAccept.removeListener")},onAcceptError:{addListener:n("chrome.bluetoothSocket.onAcceptError.addListener"),removeListener:e("chrome.bluetoothSocket.onAcceptError.removeListener")},onReceive:{addListener:n("chrome.bluetoothSocket.onReceive.addListener"),removeListener:e("chrome.bluetoothSocket.onReceive.removeListener")},onReceiveError:{addListener:n("chrome.bluetoothSocket.onReceiveError.addListener"),removeListener:e("chrome.bluetoothSocket.onReceiveError.removeListener")}}}(chrome._api),function(e){"use strict";var t,n=Array.prototype.push,o=chrome.bluetoothSocket,i=e.Transport,r=e.TransportEvent,a=0;function c(e){i.call(this,e),this._options=e,this._socketId=null,this._sendTimer=null,this._buf=[],this._messageHandler=function(e){e.socketId===this._socketId&&this.emit(r.MESSAGE,e.data)}.bind(this),this._sendOutHandler=function(){var e=new Uint8Array(this._buf).buffer;this.isOpen&&o.send(this._socketId,e),function(e){e._buf=[],clearImmediate(e._sendTimer),e._sendTimer=null}(this)}.bind(this),this._disconnHandler=function(){o.onReceive.removeListener(this._messageHandler),o.onReceiveError.removeListener(this._errorHandler),delete this._socketId,this.emit(r.CLOSE)}.bind(this),this._errorHandler=function(e){this.emit(r.ERROR,new Error(JSON.stringify(e)))}.bind(this),function n(i){var s=i._options;h(s.address,function(e,t){e||!t?i.emit(r.ERROR,new Error(e)):(o.onReceive.addListener(i._messageHandler),o.onReceiveError.addListener(i._errorHandler),o.connect(t,s.address,s.uuid,function(){chrome.runtime.lastError?(console.log(chrome.runtime.lastError.message),o.close(t,function(){o.onReceive.removeListener(i._messageHandler),o.onReceiveError.removeListener(i._errorHandler),++a<=c.MAX_RETRIES?n(i):i.emit(r.ERROR,new Error("too many retries"))})):(a=0,i._socketId=t,i.emit(r.OPEN))}))})}(this)}function h(t,n){var i;chrome.bluetooth.getAdapterState(function(e){e.available?chrome.bluetooth.getDevice(t,function(e){e?o.getSockets(function(e){e.some(function(e){if(!e.connected)return i=e.socketId,!0}),void 0===i?o.create(function(e){n(null,e.socketId)}):n(null,i)}):n('No such device "'+t+'"')}):n("Bluetooth adapter not available")})}c.prototype=t=Object.create(i.prototype,{constructor:{value:c},isOpen:{get:function(){return!!this._socketId}}}),t.send=function(e){n.apply(this._buf,e),this._sendTimer||(this._sendTimer=setImmediate(this._sendOutHandler))},t.close=function(){this._socketId&&o.close(this._socketId,this._disconnHandler)},t.flush=function(){this._buf&&this._buf.length&&this._sendOutHandler()},c.MAX_RETRIES=10,e.transport.bluetooth=c}(webduino),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t=e.util,n=e.Board;function i(e){(e=t.extend({transport:"websocket",server:i.DEFAULT_SERVER,login:"admin",password:"password",autoReconnect:!1,multi:!1,initialReset:!0,handleDigitalPins:!0},e="string"==typeof e?{url:e}:e)).server=function(e){-1===e.indexOf("://")&&(e=("undefined"!=typeof location&&"https:"===location.protocol?"wss:":"ws:")+"//"+e);return(e=t.parseURL(e)).protocol+"//"+e.host+"/"}(e.server),n.call(this,e)}i.prototype=Object.create(n.prototype,{constructor:{value:i}}),i.DEFAULT_SERVER="wss://ws.webduino.io:443",i.SERVER_CHINA="wss://ws.webduino.com.cn",e.board.Smart=i}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.util,i=e.Board,s=e.BoardEvent;function o(e){(e=n.extend({transport:"websocket",server:o.DEFAULT_SERVER,login:"admin",password:"password",autoReconnect:!1,multi:!1,initialReset:!0,handleDigitalPins:!0},e="string"==typeof e?{url:e}:e)).server=function(e){-1===e.indexOf("://")&&(e=("undefined"!=typeof location&&"https:"===location.protocol?"wss:":"ws:")+"//"+e);return(e=n.parseURL(e)).protocol+"//"+e.host+"/"}(e.server),i.call(this,e)}o.prototype=t=Object.create(i.prototype,{constructor:{value:o}}),o.DEFAULT_SERVER="wss://ws.webduino.io:443",o.SERVER_CHINA="wss://ws.webduino.com.cn",t.startup=function(){this._isReady=!0,this.emit(s.READY,this),setTimeout(function(){"serial"===this._options.transport&&this.send([240,14,12,247])}.bind(this),500)},e.board.Bit=o}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n,s,o,i=[],r=!1,a=e.Module,c=e.BoardEvent;function h(e){var t;a.call(this),(this._board=e).on(c.SYSEX_MESSAGE,function(e){var t=e.message;if(r=!1,32==t[0]&&0===t[1]){for(var n="",i=2;i<t.length;i++)n+=String.fromCharCode(t[i]);s(0,o=n)}}),t=e,setInterval(function(){var e;r||0==i.length||(r=!0,e=i.shift(),0<e.ack?t.send(e.obj):(r=!1,n()))},0)}h.prototype=t=Object.create(a.prototype,{constructor:{value:h}}),t.sendString=function(e,t){var n=[240,4,32,0];(n=n.concat(function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}(e))).push(247),this._board.send(n),void 0!==t&&(s=t)},t.onMessage=function(e){void 0!==e&&(s=e)},t.getDataString=function(){return o},e.module.DataTransfer=h}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var h,t,n=e.Module,i=e.BoardEvent,u=!1,s=!1;function o(e){s&&console.log(e)}function r(e,t){n.call(this),this._board=e,this.pinSendIR=this.pinRecvIR=-1,h=this,"object"==typeof t&&(t.send&&(this.pinSendIR=t.send),t.recv&&(this.pinRecvIR=t.recv)),h._board.on(i.SYSEX_MESSAGE,function(e){var t=e.message;if(4==t[0]&&9==t[1]&&11==t[2])o("send IR data to Board callback"),u&&(u=!1,o("send pin:"+h.pinSendIR),h._board.send([240,4,9,12,h.pinSendIR,247]));else if(4==t[0]&&9==t[1]&&12==t[2])o("trigger IR send callback..."),h.irSendCallback();else if(4==t[0]&&9==t[1]&&13==t[2]){o("record IR callback...");for(var n="",i=3;i<t.length;i++)n+=String.fromCharCode(t[i]);h.irData=n.substring(4),h.irRecvCallback(h.irData)}else o(e)})}function a(e,t){for(var n=0;n<e.length;n+=t){for(var i=e.substring(n,n+t),s=(c=a=r=o=s=void 0,n/8),o=i,r=(r=[]).concat([240,4,9,10]),a=(a="0000"+s.toString(16)).substring(a.length-4),c=0;c<4;c++)r.push(a.charCodeAt(c));for(r.push(247),r=r.concat([240,4,9,11]),c=0;c<o.length;c++)r.push(o.charCodeAt(c));r.push(247),h._board.send(r)}u=!0}r.prototype=t=Object.create(n.prototype,{constructor:{value:r}}),t.recv=function(e){h.irRecvCallback=e,0<h.pinRecvIR&&(h._board.send([240,4,9,13,h.pinRecvIR,247]),o("wait recv..."))},t.send=function(e,t){0<h.pinSendIR&&(a(e,32),h.irSendCallback=t)},t.debug=function(e){"boolean"==typeof e&&(h.isDebug=e)},t.sendPin=function(e){this.pinSendIR=e},t.recvPin=function(e){this.pinRecvIR=e},e.module.IRRAW=r}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var s,t,o,n,r=[],a=!1,c=e.Module,h=e.BoardEvent,u=0,l=[];function i(e,t,n){var i;c.call(this),this._board=e,this._rx=t,this._tx=n,s=this,e.on(h.SYSEX_MESSAGE,function(){var e;u--,a=!1,0<l.length&&(e=l.shift(),s._board.send(e))}),i=e,setInterval(function(){var e;u==l.length&&0<l.length&&(e=l.shift(),i.send(e)),a||0==r.length||(a=!0,e=r.shift(),0<e.ack?i.send(e.obj):(a=!1,o()))},0)}i.prototype=t=Object.create(c.prototype,{constructor:{value:i},play:{get:function(){return n},set:function(e){n=e}}}),t.init=function(){var e=[240,4,25,0,this._rx,this._tx,247];u++,this._board.send(e)},t.play=function(e){u++,l.push([240,4,25,1,e,247])},t.start=function(){u++,l.push([240,4,25,2,247])},t.stop=function(){u++,l.push([240,4,25,3,247])},t.pause=function(){u++,l.push([240,4,25,4,247])},t.volume=function(e){u++,l.push([240,4,25,5,e,247])},t.previous=function(){u++,l.push([240,4,25,6,247])},t.next=function(){u++,l.push([240,4,25,7,247])},t.loop=function(e){u++,l.push([240,4,25,8,e,247])},e.module.DFPlayer=i}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n,i,s=[],o=!1,r=e.Module,a=e.BoardEvent;function c(e){var t;r.call(this),(this._board=e).send([240,4,24,0,247]),e.on(a.SYSEX_MESSAGE,function(){o=!1}),t=e,setInterval(function(){var e;o||0==s.length||(o=!0,e=s.shift(),0<e.ack?t.send(e.obj):(o=!1,n()))},0)}c.prototype=t=Object.create(r.prototype,{constructor:{value:c},backlight:{get:function(){return i},set:function(e){i=e}}}),t.print=function(e){var t=[240,4,24,2];(t=t.concat(function(e){for(var t=[],n=0;n<e.length;n++){var i=e.charCodeAt(n).toString(16),s=(i=1==i.length?"0"+i:i).charAt(0),i=i.charAt(1);t.push(s.charCodeAt(0)),t.push(i.charCodeAt(0))}return t}(e))).push(247),this._board.send(t)},t.cursor=function(e,t){this._board.send([240,4,24,1,e,t,247])},t.clear=function(){this._board.send([240,4,24,3,247])},e.module.LCD1602=c}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Pin,s=e.Module,o=e.BoardEvent;function r(e,t,n){if(s.call(this),this._board=e,this._pin=t,this._driveMode=n||r.SOURCE_DRIVE,this._supportsPWM=void 0,this._blinkTimer=null,this._board.on(o.BEFOREDISCONNECT,this._clearBlinkTimer.bind(this)),this._board.on(o.ERROR,this._clearBlinkTimer.bind(this)),this._driveMode===r.SOURCE_DRIVE)this._onValue=1,this._offValue=0;else{if(this._driveMode!==r.SYNC_DRIVE)throw new Error("driveMode should be Led.SOURCE_DRIVE or Led.SYNC_DRIVE");this._onValue=0,this._offValue=1}t.capabilities[i.PWM]?(e.setDigitalPinMode(t.number,i.PWM),this._supportsPWM=!0):(e.setDigitalPinMode(t.number,i.DOUT),this._supportsPWM=!1)}function a(t,e,n,i){t._board.queryPinState(e,function(e){e.state===n&&i.call(t)})}r.prototype=t=Object.create(s.prototype,{constructor:{value:r},intensity:{get:function(){return this._pin.value},set:function(e){this._supportsPWM||(e=e<.5?0:1),this._driveMode===r.SOURCE_DRIVE?this._pin.value=e:this._driveMode===r.SYNC_DRIVE&&(this._pin.value=1-e)}}}),t.on=function(e){this._clearBlinkTimer(),this._pin.value=this._onValue,"function"==typeof e&&a(this,this._pin,this._pin.value,e)},t.off=function(e){this._clearBlinkTimer(),this._pin.value=this._offValue,"function"==typeof e&&a(this,this._pin,this._pin.value,e)},t.toggle=function(e){this._blinkTimer?this.off():this._pin.value=1-this._pin.value,"function"==typeof e&&a(this,this._pin,this._pin.value,e)},t.blink=function(e,t){1===arguments.length&&"function"==typeof arguments[0]&&(t=arguments[0]),e=parseInt(e),e=isNaN(e)||e<=0?1e3:e,this._clearBlinkTimer(),this._blinkTimer=this._blink(e,t)},t._blink=function(e,t){var n=this;return setTimeout(function(){n._pin.value=1-n._pin.value,"function"==typeof t&&a(n,n._pin,n._pin.value,t),n._blinkTimer=n._blink(e,t)},e)},t._clearBlinkTimer=function(){this._blinkTimer&&(clearTimeout(this._blinkTimer),this._blinkTimer=null)},r.SOURCE_DRIVE=0,r.SYNC_DRIVE=1,e.module.Led=r}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,o=e.module.Led,r=e.Module;function a(e,t,n,i,s){r.call(this),void 0===s&&(s=a.COMMON_ANODE),this._board=e,this._redLed=new o(e,t,s),this._greenLed=new o(e,n,s),this._blueLed=new o(e,i,s),this.setColor(0,0,0)}a.prototype=t=Object.create(r.prototype,{constructor:{value:a}}),t.setColor=function(e,t,n,i){var s,o,r,a,c;void 0!==t&&"function"!=typeof t||(s="#"==(s=e).charAt(0)?s.substring(1,7):s,i=t,e=parseInt(s.substring(0,2),16),t=parseInt(s.substring(2,4),16),n=parseInt(s.substring(4,6),16)),e/=255,t/=255,n/=255,this._redLed.intensity=e,this._greenLed.intensity=t,this._blueLed.intensity=n,"function"==typeof i&&(r=(o=this)._redLed._pin,a=this._greenLed._pin,c=this._blueLed._pin,this._board.queryPinState([r,a,c],function(e){e[0].state===r.value&&e[1].state===a.value&&e[2].state===c.value&&i.call(o)}))},a.COMMON_ANODE=o.SYNC_DRIVE,a.COMMON_CATHODE=o.SOURCE_DRIVE,e.module.RGBLed=a}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var s=e.PinEvent,o=e.Pin,r=e.Module,a={PRESS:"pressed",RELEASE:"released",LONG_PRESS:"longPress",SUSTAINED_PRESS:"sustainedPress"};function c(e,t,n,i){r.call(this),this._board=e,this._pin=t,this._repeatCount=0,this._timer=null,this._timeout=null,this._buttonMode=n||c.PULL_DOWN,this._sustainedPressInterval=i||1e3,this._debounceInterval=20,this._pressHandler=function(){this.emit(a.PRESS),this._timer&&(clearInterval(this._timer),delete this._timer);this._timer=setInterval(this._sustainedPressHandler,this._sustainedPressInterval)}.bind(this),this._releaseHandler=function(){this.emit(a.RELEASE),this._timer&&(clearInterval(this._timer),delete this._timer);this._repeatCount=0}.bind(this),this._sustainedPressHandler=function(){0<this._repeatCount?this.emit(a.SUSTAINED_PRESS):this.emit(a.LONG_PRESS);this._repeatCount++}.bind(this),e.setDigitalPinMode(t.number,o.DIN),this._buttonMode===c.INTERNAL_PULL_UP?(e.enablePullUp(t.number),this._pin.value=o.HIGH):this._buttonMode===c.PULL_UP&&(this._pin.value=o.HIGH),this._pin.on(s.CHANGE,function(e){var t,e=e.value;this._buttonMode===c.PULL_DOWN?t=1===e?this._pressHandler:this._releaseHandler:this._buttonMode!==c.PULL_UP&&this._buttonMode!==c.INTERNAL_PULL_UP||(t=1===e?this._releaseHandler:this._pressHandler);this._timeout&&clearTimeout(this._timeout);this._timeout=setTimeout(t,this._debounceInterval)}.bind(this))}c.prototype=Object.create(r.prototype,{constructor:{value:c},buttonMode:{get:function(){return this._buttonMode}},sustainedPressInterval:{get:function(){return this._sustainedPressInterval},set:function(e){this._sustainedPressInterval=e}}}),c.PULL_DOWN=0,c.PULL_UP=1,c.INTERNAL_PULL_UP=2,e.module.ButtonEvent=a,e.module.Button=c}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Module,s=e.BoardEvent,a=1,c={PING:"ping",PING_ERROR:"pingError"};function n(e,t,n){i.call(this),this._type="HC-SR04",this._board=e,this._trigger=t,this._echo=n,this._distance=null,this._lastRecv=null,this._pingTimer=null,this._pingCallback=function(){},this._board.on(s.BEFOREDISCONNECT,this.stopPing.bind(this)),this._messageHandler=function(e){e=e.message;if(e[0]===a){var t,n,i=this,s=e,o="",r=3;if(s[1]===i._trigger.number&&s[2]===i._echo.number){for(;r<s.length;)t=s[r],n=s[r+1],o+=t-48,n&&(o+=n-48),r+=2;i._lastRecv=Date.now(),i.emit(c.PING,parseInt(o))}}}.bind(this),this._board.on(s.ERROR,this.stopPing.bind(this))}n.prototype=t=Object.create(i.prototype,{constructor:{value:n},distance:{get:function(){return this._distance}}}),t.ping=function(t,e){var n,i=this;if(i.stopPing(),"function"!=typeof t)return new Promise(function(t){i.ping(function(e){setTimeout(function(){t(e)},30)})});i._pingCallback=function(e){i._distance=e,t(e)},i._board.on(s.SYSEX_MESSAGE,i._messageHandler),i.on(c.PING,i._pingCallback),(n=function(){i._board.sendSysex(a,[i._trigger.number,i._echo.number]),e&&(e=Math.max(e,20),null===i._lastRecv||Date.now()-i._lastRecv<5*e?i._pingTimer=setTimeout(n,e):(i.stopPing(),setTimeout(function(){i.ping(t,e)},5e3)))})()},t.stopPing=function(){this.removeListener(c.PING,this._pingCallback),this._board.removeListener(s.SYSEX_MESSAGE,this._messageHandler),this._lastRecv=null,this._pingTimer&&(clearTimeout(this._pingTimer),delete this._pingTimer)},e.module.UltrasonicEvent=c,e.module.Ultrasonic=n}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var s=e.Pin,o=e.Module;function t(e,t,n,i){o.call(this),this._type="SG90",this._board=e,this._pin=t,this._angle=void 0,this._minAngle=n||0,this._maxAngle=i||180,e.sendServoAttach(t.number),e.setDigitalPinMode(t.number,s.SERVO)}t.prototype=Object.create(o.prototype,{constructor:{value:t},angle:{get:function(){if(this._pin._type===s.SERVO)return this._angle},set:function(e){this._pin._type===s.SERVO&&(this._angle=e,this._pin.value=Math.max(0,Math.min(1,(this._angle-this._minAngle)/(this._maxAngle-this._minAngle)*t.COEF_TO_0_180)))}}}),t.COEF_TO_0_180=180/255,e.module.Servo=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n=e.PinEvent,i=e.Pin,s=e.Module,o={HIGH:"high",LOW:"low"};function t(e,t){s.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,i.DIN),this._pin.value=i.HIGH,this._pin.on(n.CHANGE,function(e){e.value===i.HIGH?this.emit(o.HIGH):this.emit(o.LOW)}.bind(this))}t.prototype=Object.create(s.prototype,{constructor:{value:t}}),e.module.TiltEvent=o,e.module.Tilt=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n=e.PinEvent,i=e.Pin,s=e.Module,o={DETECTED:"detected",ENDED:"ended"};function t(e,t){s.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,i.DIN),this._pin.value=i.HIGH,this._pin.on(n.CHANGE,function(e){e.value===i.HIGH?this.emit(o.DETECTED):this.emit(o.ENDED)}.bind(this))}t.prototype=Object.create(s.prototype,{constructor:{value:t}}),e.module.PirEvent=o,e.module.Pir=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n=e.PinEvent,i=e.Pin,s=e.Module,o={HIGH:"high",LOW:"low"};function t(e,t){s.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,i.DIN),this._pin.value=i.HIGH,this._pin.on(n.CHANGE,function(e){e.value===i.HIGH?this.emit(o.HIGH):this.emit(o.LOW)}.bind(this))}t.prototype=Object.create(s.prototype,{constructor:{value:t}}),e.module.ShockEvent=o,e.module.Shock=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var n=e.PinEvent,i=e.Pin,s=e.Module,o={DETECTED:"detected",ENDED:"ended"};function t(e,t){s.call(this),this._type="FC_04",this._board=e,this._pin=t,e.setDigitalPinMode(t.number,i.DIN),this._pin.value=i.HIGH,this._pin.on(n.CHANGE,function(e){e.value===i.LOW?this.emit(o.DETECTED):this.emit(o.ENDED)}.bind(this))}t.prototype=Object.create(s.prototype,{constructor:{value:t}}),e.module.SoundEvent=o,e.module.Sound=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Pin,i=e.Module;function s(e,t){i.call(this),this._type="KY-019",this._board=e,this._pin=t,this._onValue=1,this._offValue=0,e.setDigitalPinMode(t.number,n.DOUT),this.off()}function o(t,e,n,i){t._board.queryPinState(e,function(e){e.state===n&&i.call(t)})}s.prototype=t=Object.create(i.prototype,{constructor:{value:s}}),t.on=function(e){this._pin.value=this._onValue,"function"==typeof e&&o(this,this._pin,this._pin.value,e)},t.off=function(e){this._pin.value=this._offValue,"function"==typeof e&&o(this,this._pin,this._pin.value,e)},t.toggle=function(e){this._pin.value=1-this._pin.value,"function"==typeof e&&o(this,this._pin,this._pin.value,e)},e.module.Relay=s}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,s=e.BoardEvent,c=[4,4],h={READ:"read",READ_ERROR:"readError"};function i(e,t){n.call(this),this._type="DHT11",this._board=e,this._pin=t,this._humidity=null,this._temperature=null,this._lastRecv=null,this._readTimer=null,this._readCallback=function(){},this._board.on(s.BEFOREDISCONNECT,this.stopRead.bind(this)),this._messageHandler=function(e){e=e.message;if(e[0]===c[0]&&e[1]===c[1]){var t,n,i=this,s=e,o="",r=3,a=[];if(s[2]===i._pin.number){for(;r<s.length;)t=s[r],n=s[r+1],o+=t-48,n&&(o+=n-48),((r+=2)-3)%4==0&&(a.push(parseInt(o)/100),o="");i._lastRecv=Date.now(),i.emit(h.READ,a[0],a[1])}}}.bind(this),this._board.on(s.ERROR,this.stopRead.bind(this))}i.prototype=t=Object.create(n.prototype,{constructor:{value:i},humidity:{get:function(){return this._humidity}},temperature:{get:function(){return this._temperature}}}),t.read=function(n,e){var t,i=this;if(i.stopRead(),"function"!=typeof n)return new Promise(function(t){i.read(function(e){i._humidity=e.humidity,i._temperature=e.temperature,setTimeout(function(){t(e)},30)})});i._readCallback=function(e,t){i._humidity=e,i._temperature=t,n({humidity:e,temperature:t})},i._board.on(s.SYSEX_MESSAGE,i._messageHandler),i.on(h.READ,i._readCallback),(t=function(){i._board.sendSysex(c[0],[c[1],i._pin.number]),e&&(e=Math.max(e,1e3),null===i._lastRecv||Date.now()-i._lastRecv<5*e?i._readTimer=setTimeout(t,e):(i.stopRead(),setTimeout(function(){i.read(n,e)},6e3)))})()},t.stopRead=function(){this.removeListener(h.READ,this._readCallback),this._board.removeListener(s.SYSEX_MESSAGE,this._messageHandler),this._lastRecv=null,this._readTimer&&(clearTimeout(this._readTimer),delete this._readTimer)},e.module.DhtEvent=h,e.module.Dht=i}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,o=Array.prototype.push,r=e.util,n=e.Module,i=e.BoardEvent,s=[4,7],a="playing",c="stopped",h="paused",u={REST:0,B0:31,C1:33,CS1:35,D1:37,DS1:39,E1:41,F1:44,FS1:46,G1:49,GS1:52,A1:55,AS1:58,B1:62,C2:65,CS2:69,D2:73,DS2:78,E2:82,F2:87,FS2:93,G2:98,GS2:104,A2:110,AS2:117,B2:123,C3:131,CS3:139,D3:147,DS3:156,E3:165,F3:175,FS3:185,G3:196,GS3:208,A3:220,AS3:233,B3:247,C4:262,CS4:277,D4:294,DS4:311,E4:330,F4:349,FS4:370,G4:392,GS4:415,A4:440,AS4:466,B4:494,C5:523,CS5:554,D5:587,DS5:622,E5:659,F5:698,FS5:740,G5:784,GS5:831,A5:880,AS5:932,B5:988,C6:1047,CS6:1109,D6:1175,DS6:1245,E6:1319,F6:1397,FS6:1480,G6:1568,GS6:1661,A6:1760,AS6:1865,B6:1976,C7:2093,CS7:2217,D7:2349,DS7:2489,E7:2637,F7:2794,FS7:2960,G7:3136,GS7:3322,A7:3520,AS7:3729,B7:3951,C8:4186,CS8:4435,D8:4699,DS8:4978};function l(e,t){n.call(this),this._board=e,this._pin=t,this._timer=null,this._sequence=null,this._state=c,this._board.on(i.BEFOREDISCONNECT,this.stop.bind(this)),this._board.on(i.ERROR,this.stop.bind(this))}function d(e){return e=isNaN(e=parseInt(e))?100:e,Math.max(e,100)}l.prototype=t=Object.create(n.prototype,{constructor:{value:l}}),t.tone=function(e,t){var n=[];isNaN(e=parseInt(e))||e<=0||9999<e||(e=("0000"+e).substr(-4,4),n[0]=parseInt("0x"+e[0]+e[1]),n[1]=parseInt("0x"+e[2]+e[3]),t=Math.round(d(t)/100),this._board.sendSysex(s[0],[s[1],this._pin.number].concat(n).concat(t)))},t.play=function(e,t){if(void 0!==e){var n=e.length,i=function(e,t){var n=e.length,i=n?e[n-1]:100;if(n<t){o.apply(e,new Array(t-n));for(var s=n;s<e.length;s++)e[s]=i}return e}((r.isArray(t)?t:[]).map(function(e){return d(1e3/e)}),n);this.stop(),this._sequence=[];for(var s=n-1;0<=s;s--)this._sequence.push({frequency:u[e[s].toUpperCase()],duration:i[s]})}else if(this._state===a)return;this._state=a,function e(t){var n=t._sequence;n&&0<n.length?(n=n.pop(),t.tone(n.frequency,n.duration),t._timer=setTimeout(function(){e(t)},n.duration+l.TONE_DELAY)):t.stop()}(this)},t.pause=function(){this._state===a&&(this._timer&&(clearTimeout(this._timer),delete this._timer),this._state=h)},t.stop=function(){this._timer&&(clearTimeout(this._timer),delete this._timer),delete this._sequence,this._state=c},l.FREQUENCY=u,l.TONE_DELAY=60,e.module.Buzzer=l}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,s=e.Module,o=e.BoardEvent;function n(e,t,n,i){s.call(this),this._board=e,this._din=t,this._cs=n,this._clk=i,this._intensity=0,this._data="ffffffffffffffff",this._board.on(o.BEFOREDISCONNECT,this.animateStop.bind(this)),this._board.on(o.ERROR,this.animateStop.bind(this)),this._board.send([240,4,8,0,t.number,n.number,i.number,247])}n.prototype=t=Object.create(s.prototype,{constructor:{value:n},intensity:{get:function(){return this._intensity},set:function(e){0<=e&&e<=15&&(this._board.send([240,4,8,3,e,247]),this._intensity=e)}}}),t.on=function(e){if(e?this._data=e:e=this._data,!e)return!1;for(var t=[240,4,8,1],n=0,i=e.length;n<i;n++)t.push(e.charCodeAt(n));t.push(247),this._board.send(t)},t.off=function(){this._board.send([240,4,8,2,247])},t.animate=function(e,t,n,i){var s=0,o=(i="function"==typeof arguments[arguments.length-1]?arguments[arguments.length-1]:function(){},function(){this.on(e[s++%e.length]),this._timer=setTimeout(o,t)}.bind(this)),r=function(){clearTimeout(this._timer),i()}.bind(this);t&&0<t&&o(),n&&0<n&&(this._timerDuration=setTimeout(r,n))},t.animateStop=function(){clearTimeout(this._timer),clearTimeout(this._timerDuration)},e.module.Max7219=n}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,o={MESSAGE:"message"};function s(e){n.call(this),this._board=e,this._baseAxis="z",this._sensitive=10,this._detectTime=50,this._messageHandler=function(e){var t,n,i=e.message,s=!0;if(9!==i.length)return!1;if([4,11,4].forEach(function(e,t){e!==i[t]&&(s=!1)}),!s)return!1;e=(i[3]<<8|i[4])-1024,t=(i[5]<<8|i[6])-1024,n=(i[7]<<8|i[8])-1024,this.emit(o.MESSAGE,e,t,n)}.bind(this),this._init=!1,this._info={x:0,y:0,z:0,fXg:0,fYg:0,fZg:0},this._callback=function(){},this._board.send([240,4,11,0,247])}s.prototype=t=Object.create(n.prototype,{constructor:{value:s},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.detect=t.on=function(f){var p=this;this._board.send([240,4,11,1,247]),"function"!=typeof f&&(f=function(){}),this._callback=function(e,t,n){var i,s,o,r,a,c,h,u,l,d,_=p._info;p._init||(p._init=!0,s=this._baseAxis,o={x:e,y:t,z:n},r=_,Object.getOwnPropertyNames(o).forEach(function(e){r[e]=o[e],e===s&&(0<o[e]?r[e]=o[e]-256:r[e]=o[e]+256)})),e-=_.x,t-=_.y,n-=_.z,a=e,c=t,h=n,u=_.fXg,l=_.fYg,d=_.fZg,u=.5*a+.5*u,l=.5*c+.5*l,d=.5*h+.5*d,a=180*Math.atan2(-l,d)/Math.PI,c=180*Math.atan2(u,Math.sqrt(l*l+d*d))/Math.PI,i={roll:a=a.toFixed(2),pitch:c=c.toFixed(2),fXg:u,fYg:l,fZg:d},["fXg","fYg","fZg"].forEach(function(e){_[e]=i[e]}),e=(e/256).toFixed(2),t=(t/256).toFixed(2),n=(n/256).toFixed(2),f(e,t,n,i.roll,i.pitch)},this._state="on",this._board.on(i.SYSEX_MESSAGE,this._messageHandler),this.addListener(o.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.send([240,4,11,2,247]),this._board.removeListener(i.SYSEX_MESSAGE,this._messageHandler),this.removeListener(o.MESSAGE,this._callback),this._callback=null},t.refresh=function(){!(this._init=!1)===this._init&&(this._info={x:0,y:0,z:0,fXg:0,fYg:0,fZg:0})},t.setBaseAxis=function(e){this._baseAxis=e},t.setSensitivity=function(e){e!==this._sensitive&&(this._sensitive=e,this._board.send([240,4,11,3,e,247]))},t.setDetectTime=function(e){e!==this._detectTime&&(this._detectTime=e,this._board.send([240,4,11,4,e,247]))},e.module.ADXL345=s}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Module,n=e.BoardEvent,s=[4,21],o={MESSAGE:"message"};function r(e,t,n){i.call(this),this._board=e,this._dt=isNaN(n)?n:e.getDigitalPin(n),this._sck=isNaN(t)?t:e.getDigitalPin(t),this._init=!1,this._weight=0,this._callback=function(){},this._messageHandler=function(e){e=e.message;e[0]==s[0]&&e[1]==s[1]&&this.emit(o.MESSAGE,e.slice(2))}.bind(this),this._board.send([240,4,21,0,this._sck._number,this._dt._number,247])}r.prototype=t=Object.create(i.prototype,{constructor:{value:r},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.measure=t.on=function(i){var s=this;this._board.send([240,4,21,1,247]),"function"!=typeof i&&(i=function(){}),this._callback=function(e){for(var t="",n=0;n<e.length;n++)t+=e[n]-48;s._weight=parseFloat(t),i(s._weight)},this._state="on",this._board.on(n.SYSEX_MESSAGE,this._messageHandler),this.addListener(o.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.send([240,4,21,2,247]),this._board.removeListener(n.SYSEX_MESSAGE,this._messageHandler),this.removeListener(o.MESSAGE,this._callback),this._callback=null},e.module.HX711=r}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,u,n=2,o=0,r=0,l=[],i=!1,s=e.Module,a=e.BoardEvent;function c(e){var t;s.call(this),(this._board=e).send([240,4,1,0,247]),e.send([240,4,1,2,o,r,247]),e.send([240,4,1,3,n,247]),e.send([240,4,1,1,247]),e.on(a.SYSEX_MESSAGE,function(){i=!1}),t=e,setInterval(function(){var e;i||0==l.length||(i=!0,e=l.shift(),0<e.ack?t.send(e.obj):(i=!1,u()))},0)}c.prototype=t=Object.create(s.prototype,{constructor:{value:c},textSize:{get:function(){return n},set:function(e){this._board.send([240,4,1,3,e,247]),n=e}},cursorX:{get:function(){return o},set:function(e){o=e}},cursorY:{get:function(){return r},set:function(e){r=e}}}),t.clear=function(){this._board.send([240,4,1,1,247])},t.drawImage=function(e){this._board.send([240,4,1,5,e,247])},t.render=function(){this._board.send([240,4,1,6,247])},t.save=function(e,t){u=t;for(var n=0;n<e.length;n+=50){var i=e.substring(n,n+50),s=(h=c=a=r=o=s=void 0,n/2),o=i,r=[240,4,1,10],a=[],c=(a=a.concat(r),"0000"+s.toString(16));c=c.substring(c.length-4);for(var h=0;h<4;h++)a.push(c.charCodeAt(h));for(a.push(247),r=[240,4,1,11],a=a.concat(r),h=0;h<o.length;h++)a.push(o.charCodeAt(h));a.push(247),l.push({obj:a,ack:11})}l.push({obj:{},ack:0})},t.print=function(e,t,n){3==arguments.length?(o=e,r=t,this._board.send([240,4,1,2,e,t,247])):(n=e,this._board.send([240,4,1,2,o,r,247]));for(var i=[240,4,1,4],s=0;s<n.length;s++)i.push(n.charCodeAt(s));i.push(247),this._board.send(i)},e.module.SSD1306=c}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Module,n=e.BoardEvent,s=[4,22],o={MESSAGE:"message"};function r(e,t,n){i.call(this),this._board=e,this._rx=isNaN(t)?t:e.getDigitalPin(t),this._tx=isNaN(n)?n:e.getDigitalPin(n),this._init=!1,this._scanData="",this._callback=function(){},this._messageHandler=function(e){e=e.message;e[0]==s[0]&&e[1]==s[1]&&this.emit(o.MESSAGE,e.slice(2))}.bind(this),this._board.send([240,4,22,0,this._rx._number,this._tx._number,247])}r.prototype=t=Object.create(i.prototype,{constructor:{value:r},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.scan=t.on=function(i){var s=this;this._board.send([240,4,22,1,247]),"function"!=typeof i&&(i=function(){}),this._callback=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);s._scanData=t,i(s._scanData)},this._state="on",this._board.on(n.SYSEX_MESSAGE,this._messageHandler),this.addListener(o.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.send([240,4,22,2,247]),this._board.removeListener(n.SYSEX_MESSAGE,this._messageHandler),this.removeListener(o.MESSAGE,this._callback),this._callback=null},e.module.Barcode=r}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module;function i(e,t){n.call(this),this._board=e,this._encode=t,this._board.send([244,9,3,233,0,0])}i.prototype=t=Object.create(n.prototype,{constructor:{value:i}}),t.send=function(e){var i=[9,4];(e=e||this._encode)&&(e=e.match(/\w{2}/g),i.push(8*e.length),e.forEach(function(e){for(var t=0,n=e.length;t<n;t++)i.push(e.charCodeAt(t))}),this._board.sendSysex(4,i))},t.updateEncode=function(e){this._encode=e},e.module.IRLed=i}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,c={MESSAGE:"message",MESSAGE_ERROR:"messageError"};function s(e,t){n.call(this),this._board=e,this._pin=t,this._messageHandler=function(e){var t,n,i,s=[4,16],o=e.message,r=o.slice(2),a="";for(t=0,i=s.length;t<i;t++)if(s[t]!==o[t])return!1;for(t=0;t<r.length;t++)n=String.fromCharCode(r[t]),a+=n.toLowerCase();"ffffffff"!==a?this.emit(c.MESSAGE,a):this.emit(c.MESSAGE_ERROR,a,o)}.bind(this),this._recvCallback=function(){},this._recvErrorCallback=function(){},this._board.send([240,4,10,1,247])}s.prototype=t=Object.create(n.prototype,{constructor:{value:s},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.receive=t.on=function(t,n){var e=[240,4,10,0];"function"!=typeof t&&(t=function(){}),"function"!=typeof n&&(n=function(){}),this._pin&&(e.push(this._pin.number,247),this._board.send(e),this._state="on",this._recvCallback=function(e){t(e)},this._recvErrorCallback=function(e,t){n(e,t)},this._board.on(i.SYSEX_MESSAGE,this._messageHandler),this.addListener(c.MESSAGE,this._recvCallback),this.addListener(c.MESSAGE_ERROR,this._recvErrorCallback))},t.off=function(){this._board.send([240,4,10,1,247]),this._state="off",this._board.removeListener(i.SYSEX_MESSAGE,this._messageHandler),this.removeListener(c.MESSAGE,this._recvCallback),this.removeListener(c.MESSAGE_ERROR,this._recvErrorCallback),this._recvCallback=null,this._recvErrorCallback=null},e.module.IRRecv=s}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var s=e.Module,o=e.BoardEvent,r=e.module.Button,a=e.module.ButtonEvent,c={MESSAGE:"message"};function t(e,t,n,i){s.call(this),this._board=e,this._pinX=Number(t),this._pinY=Number(n),this._pinZ=i,this._data={x:0,y:0,z:0},e.enableAnalogPin(this._pinX),e.enableAnalogPin(this._pinY),e.addListener(o.ANALOG_DATA,function(e){e=e.pin;if(e.analogNumber!==this._pinX&&e.analogNumber!==this._pinY)return!1;e.analogNumber===this._pinX&&(this._data.x=e.value);e.analogNumber===this._pinY&&(this._data.y=e.value);this.emit(c.MESSAGE,this._data.x,this._data.y,this._data.z)}.bind(this)),this._button=new r(e,i),this._button.on(a.PRESS,h.bind(this)),this._button.on(a.RELEASE,h.bind(this))}function h(){this._data.z=this._button._pin.value}t.prototype=Object.create(s.prototype,{constructor:{value:t}}),e.module.JoystickEvent=c,e.module.Joystick=t}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Module,n=e.BoardEvent,s=e.PinEvent,o=e.Pin,r={MESSAGE:"message",DETECTED:"detected",ENDED:"ended"};function a(e,t,n){i.call(this),this._board=e,t&&(this._pinNumber=Number(t),this._messageHandler=function(e){e=e.pin;if(this._pinNumber!==e.analogNumber)return!1;this.emit(r.MESSAGE,e.value)}.bind(this)),n&&(this._pin=n,e.setDigitalPinMode(n.number,o.DIN),this._pin.value=o.LOW,this._pin.on(s.CHANGE,function(e){e.value===o.HIGH?this.emit(r.DETECTED):this.emit(r.ENDED)}.bind(this)))}a.prototype=t=Object.create(i.prototype,{constructor:{value:a},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.on=function(t){"function"!=typeof t&&(t=function(){}),this._state="on",this._board.enableAnalogPin(this._pinNumber),this._analogCallback=function(e){t(e)},this._board.on(n.ANALOG_DATA,this._messageHandler),this.addListener(r.MESSAGE,this._analogCallback)},t.off=function(){this._state="off",this._board.disableAnalogPin(this._pinNumber),this._board.removeListener(n.ANALOG_DATA,this._messageHandler),this._analogCallback&&(this.removeListener(r.MESSAGE,this._analogCallback),this._analogCallback=null)},t.onEvent=function(e,t){this.addListener(e,t)},t.offEvent=function(e,t){this.removeListener(e,t)},e.module.MQ2=a}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,s={MESSAGE:"message"};function o(e,t){n.call(this),this._board=e,this._pinNumber=Number(t),this._messageHandler=function(e){e=e.pin;if(this._pinNumber!==e.analogNumber)return!1;this.emit(s.MESSAGE,e.value)}.bind(this)}o.prototype=t=Object.create(n.prototype,{constructor:{value:o},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.measure=t.on=function(t){this._board.enableAnalogPin(this._pinNumber),"function"!=typeof t&&(t=function(){}),this._callback=function(e){t(e)},this._state="on",this._board.on(i.ANALOG_DATA,this._messageHandler),this.addListener(s.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.disableAnalogPin(this._pinNumber),this._board.removeListener(i.ANALOG_DATA,this._messageHandler),this.removeListener(s.MESSAGE,this._callback),this._callback=null},e.module.Photocell=o}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,s={MESSAGE:"message"};function o(e,t){n.call(this),this._board=e,this._pinNumber=Number(t),this._messageHandler=function(e){e=e.pin;if(this._pinNumber!==e.analogNumber)return!1;this.emit(s.MESSAGE,e.value)}.bind(this)}o.prototype=t=Object.create(n.prototype,{constructor:{value:o},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.on=function(t){this._board.enableAnalogPin(this._pinNumber),"function"!=typeof t&&(t=function(){}),this._callback=function(e){t(e)},this._state="on",this._board.on(i.ANALOG_DATA,this._messageHandler),this.addListener(s.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.disableAnalogPin(this._pinNumber),this._board.removeListener(i.ANALOG_DATA,this._messageHandler),this.removeListener(s.MESSAGE,this._callback),this._callback=null},e.module.Pot=o}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,s={ENTER:"enter",LEAVE:"leave"};function o(e){n.call(this),this._board=e,this._isReading=!1,this._enterHandlers=[],this._leaveHandlers=[],this._messageHandler=function(e){var t,n=this,e=e.message;if(!e.length)return!1;1===e.length?(n._leaveHandlers.forEach(function(e){e.call(n,t)}),n.emit(s.LEAVE,t),t=null):(t=String.fromCharCode.apply(null,e),n._enterHandlers.forEach(function(e){e.call(n,t)}),n.emit(s.ENTER,t))}.bind(this),this._board.on(i.BEFOREDISCONNECT,this.destroy.bind(this)),this._board.on(i.ERROR,this.destroy.bind(this)),this._board.send([240,4,15,0,247])}o.prototype=t=Object.create(n.prototype,{constructor:{value:o},isReading:{get:function(){return this._isReading}}}),t.read=function(e,t){this._isReading||(this._board.send([240,4,15,1,247]),this._board.on(i.SYSEX_MESSAGE,this._messageHandler),this._isReading=!0),"function"==typeof e&&this._enterHandlers.push(e),"function"==typeof t&&this._leaveHandlers.push(t)},t.stopRead=function(){this._isReading&&(this._board.send([240,4,15,2,247]),this._board.removeListener(i.SYSEX_MESSAGE,this._messageHandler),this._isReading=!1,this._enterHandlers=[],this._leaveHandlers=[])},t.off=function(e,t){this.removeListener(e,t)},t.destroy=function(){this.stopRead(),this.removeAllListeners(s.ENTER),this.removeAllListeners(s.LEAVE)},e.module.RFIDEvent=s,e.module.RFID=o}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,i=e.BoardEvent,s={MESSAGE:"message"};function o(e,t){n.call(this),this._board=e,this._pinNumber=Number(t),this._messageHandler=function(e){e=e.pin;if(this._pinNumber!==e.analogNumber)return!1;this.emit(s.MESSAGE,function(e){return e=Math.round(1e4*e)/100}(e.value))}.bind(this)}o.prototype=t=Object.create(n.prototype,{constructor:{value:o},state:{get:function(){return this._state},set:function(e){this._state=e}}}),t.measure=t.on=function(t){this._board.enableAnalogPin(this._pinNumber),"function"!=typeof t&&(t=function(){}),this._callback=function(e){t(e)},this._state="on",this._board.on(i.ANALOG_DATA,this._messageHandler),this.addListener(s.MESSAGE,this._callback)},t.off=function(){this._state="off",this._board.disableAnalogPin(this._pinNumber),this._board.removeListener(i.ANALOG_DATA,this._messageHandler),this.removeListener(s.MESSAGE,this._callback),this._callback=null},e.module.Soil=o}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,i=e.Module,s=e.BoardEvent,o=[4,16],r={READ:"read",READ_ERROR:"readError"};function n(e,t,n){i.call(this),this._type="G3",this._board=e,this._rx=t,this._tx=n,this._pm25=null,this._pm10=null,this._readTimer=null,this._readCallback=function(){},this._board.on(s.BEFOREDISCONNECT,this.stopRead.bind(this)),this._messageHandler=function(e){e=e.message;if(e[0]===o[0]&&e[1]===o[1]){var t,n=this,i=e,s="";for(t=2;t<i.length;t++)s+=String.fromCharCode(i[t]);s=s.split(","),n._lastRecv=Date.now(),n.emit(r.READ,s[0],s[1])}}.bind(this),this._board.on(s.ERROR,this.stopRead.bind(this)),this._board.sendSysex(o[0],[o[1],0,t.number,n.number])}n.prototype=t=Object.create(i.prototype,{constructor:{value:n},pm25:{get:function(){return this._pm25}},pm10:{get:function(){return this._pm10}}}),t.read=function(n,e){var t,i=this;if(i.stopRead(),"function"!=typeof n)return new Promise(function(t){i.read(function(e){i._pm25=e.pm25,i._pm10=e.pm10,setTimeout(function(){t(e)},30)})});i._readCallback=function(e,t){i._pm25=e,i._pm10=t,n({pm25:e,pm10:t})},i._board.on(s.SYSEX_MESSAGE,i._messageHandler),i.on(r.READ,i._readCallback),(t=function(){i._board.sendSysex(o[0],[o[1],3]),e&&(e=Math.max(e,1e3),null===i._lastRecv||Date.now()-i._lastRecv<5*e?i._readTimer=setTimeout(t,e):(i.stopRead(),setTimeout(function(){i.read(n,e)},6e3)))})()},t.stopRead=function(){this.removeListener(r.READ,this._readCallback),this._board.removeListener(s.SYSEX_MESSAGE,this._messageHandler),this._lastRecv=null,this._readTimer&&(clearTimeout(this._readTimer),delete this._readTimer)},e.module.G3Event=r,e.module.G3=n}),function(e,t){"undefined"==typeof exports?t(e.webduino||{}):module.exports=t}(this,function(e){"use strict";var t,n=e.Module,r=e.BoardEvent,a={MESSAGE:"message"};function i(e,t){n.call(this),this._board=e,this._stepperNumber=Number(t.stepperNumber),this._interface=Number(t.interface),this._stepPerRevolution=Number(t.stepsPerRevolution),this._pin1=Number(t.pin1),this._pin2=Number(t.pin2),this._pin3=Number(t.pin3),this._pin4=Number(t.pin4),this._messageHandler=function(e){e=e.message;if(e[0]!==Number(114))return!1;this.emit(a.MESSAGE,{status:!0,stepperNumber:e[1]})}.bind(this);e=c(this._stepPerRevolution,2),t=[].concat(240,114,0,this._stepperNumber,this._interface,e,this._pin1,this._pin3,this._pin2,this._pin4,247);this._board.send(t)}function c(e,t){for(var n,i=e.toString(2),s=[],o=i.length,r=1;r<t+1;r++)s.push(i.slice(n=-7*r,o)),o=n;return s.forEach(function(e,t,n){e=parseInt(e,2),n[t]=e=0<e?e:0}),s}i.prototype=t=Object.create(n.prototype,{constructor:{value:i}}),t.on=function(e,t){var n=this,i=Number(e.stepperNumber)||0,s=Number(e.direction)||0,o=Number(e.stepNumber)||0,e=c(Number(e.speed)||10,2),o=c(o,3),i=[].concat(240,114,1,i,s,o,e,247);this._board.send(i),"function"!=typeof t&&(t=function(){}),this._callback=function(e){n.off(),t(e)},this._board.on(r.SYSEX_MESSAGE,this._messageHandler),this.addListener(a.MESSAGE,this._callback)},t.off=function(){this._board.removeListener(r.SYSEX_MESSAGE,this._messageHandler),this.removeListener(a.MESSAGE,this._callback),this._callback=null},e.module.Stepper=i});